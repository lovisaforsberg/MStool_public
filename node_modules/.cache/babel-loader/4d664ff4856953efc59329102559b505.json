{"ast":null,"code":"var _jsxFileName = \"/Users/lovisaforsberg/MS_vis/ms_viz/src/components/barchart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport * as d3 from 'd3';\nimport '../../node_modules/@ibm/plex/css/ibm-plex.css';\nimport '../style/barchart.css';\nimport testData from '../data/sveaskog.csv';\nimport { SentimentContext } from '../App';\nimport { HoverSentContext } from './graphContainer';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst BarChart = () => {\n  _s();\n\n  const SentSentimentContext = useContext(SentimentContext);\n  const {\n    choosenSentiment,\n    setChoosenSentiment\n  } = SentSentimentContext;\n  const SentHoverSentContext = useContext(HoverSentContext);\n  const {\n    hoverSent,\n    setHoverSent\n  } = SentHoverSentContext;\n  const d3Container = useRef(null);\n  var post_data = [];\n  var keys = [];\n  var sent = [];\n  var eng = [];\n  var stack_key_mapping = {\n    \"Positive\": \"Sentiment\",\n    \"Negative\": \"Sentiment\",\n    \"Neutral\": \"Sentiment\",\n    \"Comments\": \"Engagement\",\n    \"Likes\": \"Engagement\",\n    \"Shares\": \"Engagement\"\n  };\n\n  const getPosts = data => {\n    if (!('children' in data)) {\n      keys.push(data.name);\n      sent.push(data.pos);\n      eng.push(data.comments);\n      post_data.push({\n        postname: data.name,\n        values: [//{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n        //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n        {\n          name: 'Positive',\n          value: data.pos,\n          yoffset: data.pos,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu\n        }, {\n          name: 'Negative',\n          value: data.neg,\n          yoffset: data.neg + data.pos,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu\n        }, {\n          name: 'Neutral',\n          value: data.neu,\n          yoffset: data.pos + data.neg + data.neu,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu\n        }, {\n          name: 'Comments',\n          value: data.comments,\n          yoffset: data.comments,\n          yscale: 0,\n          total: data.comments + data.likes + data.shares\n        }, {\n          name: 'Likes',\n          value: data.likes,\n          yoffset: data.comments + data.likes,\n          yscale: 0,\n          total: data.comments + data.likes + data.shares\n        }, {\n          name: 'Shares',\n          value: data.shares,\n          yoffset: data.comments + data.likes + data.shares,\n          yscale: 0,\n          total: data.comments + data.likes + data.shares\n        }]\n      });\n    } else {\n      data.children.forEach(child => {\n        getPosts(child);\n      });\n    }\n  };\n\n  const handleHover = type => {\n    if (type === 'Likes' || type === 'Comments' || type === 'Shares') {\n      setHoverSent('eng');\n    } else {\n      setHoverSent(type);\n    }\n  };\n\n  getPosts(choosenSentiment);\n  useEffect(() => {\n    d3.select(\".root_barchart\").selectAll('*').remove();\n    d3.select(\".legend\").selectAll('*').remove();\n    var margin = {\n      top: 20,\n      right: 40,\n      bottom: 30,\n      left: 40\n    },\n        width = 500 - margin.left - margin.right,\n        height = 250 - margin.top - margin.bottom;\n    var divTooltip = d3.select('body').append('div').attr('class', 'toolTip').attr('font-size', '100px');\n    var x0 = d3.scaleBand().domain(keys).rangeRound([0, width]).padding(0.4);\n    var x1 = d3.scaleBand().domain(['Engagement', 'Sentiment']).rangeRound([0, x0.bandwidth()]).padding(0.05);\n    var y0 = d3.scaleLinear().range([height, 0]) //.domain([0,Math.max(...eng)]);\n    .domain([0, d3.max(post_data, function (d) {\n      return d.values[3].value + d.values[4].value + d.values[5].value;\n    })]);\n    var y1 = d3.scaleLinear().range([height, 0]).domain([0, 100]);\n    var color = d3.scaleOrdinal(['#63A37B', '#F15645', '#E5E5E5', '#005282', '#336D90', '#6692AC']);\n    var xAxis = d3.axisBottom(x0) //.scale(x0)\n    .ticks(5);\n    var yAxisLeft = d3.axisLeft(y0) //.scale(y0)\n    .tickFormat(function (d) {\n      return parseInt(d);\n    });\n    var yAxisRight = d3.axisRight(y1) // .scale(y1)\n    .tickFormat(function (d) {\n      return parseInt(d);\n    });\n    var svg = d3.select(d3Container.current).attr('class', 'root_barchart').attr(\"preserveAspectRatio\", \"xMinYMin meet\").attr(\"viewBox\", \"0 0 300 300\").append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\"); // Ticks on x-axis and y-axis\n\n    svg.append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", \"translate(0,\" + height + \")\").call(xAxis) //.selectAll(\".tick text\")\n    //.call(wrap, x0.bandwidth())\n    .selectAll(\"text\").style(\"text-anchor\", \"end\").attr(\"dx\", \"0.8em\").attr(\"dy\", \"1em\").attr('overflow', 'visible').attr(\"transform\", \"rotate(-25)\");\n    svg.append(\"g\").attr(\"class\", \"y0 axis\").call(yAxisLeft).append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"y\", 6).attr(\"dy\", \".71em\").style(\"text-anchor\", \"end\").style(\"fill\", \"#005282\").text(\"Engagement\");\n    svg.select('.y0.axis').selectAll('.tick').attr('overflow', 'visible').style(\"fill\", \"#98abc5\");\n    svg.append(\"g\").attr(\"class\", \"y1 axis\").attr(\"transform\", \"translate(\" + width + \",0)\").call(yAxisRight).append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"y\", -16).attr(\"dy\", \".71em\").style(\"text-anchor\", \"end\").style(\"fill\", \"#63A37B\").text(\"Sentiment\");\n    svg.select('.y1.axis').selectAll('.tick').style(\"fill\", \"#d0743c\"); // End ticks\n\n    var graph = svg.selectAll(\".date\").attr('class', 'graph').data(post_data) //.enter()\n    //.append(\"g\")\n    .join('g').attr(\"class\", \"g\").attr(\"transform\", function (d) {\n      return \"translate(\" + x0(d.postname) + \",0)\";\n    });\n    graph.selectAll(\"rect\").data(function (d) {\n      return d.values;\n    }).join('rect').attr(\"width\", x1.bandwidth()).attr(\"x\", function (d) {\n      return x1(stack_key_mapping[d.name]);\n    }).attr(\"y\", function (d) {\n      return d.yscale == 0 ? y0(d.yoffset) : y1(d.yoffset);\n    }).attr(\"height\", function (d) {\n      return height - (d.yscale == 0 ? y0(d.value) : y1(d.value));\n    }).style(\"fill\", function (d) {\n      return color(d.name);\n    }).style(\"cursor\", \"pointer\").on('mousemove', function (d) {\n      console.log(d.name);\n      handleHover(d.name);\n      divTooltip.style('left', d3.event.pageX + 10 + 'px').style('top', d3.event.pageY - 25 + 'px').style('display', 'inline-block').html(stack_key_mapping[d.name] === 'Engagement' ? 'Total ' + stack_key_mapping[d.name] + ' ' + d.total + '</br>' + d.name + ': ' + d.value : d.name + ': ' + d.value + ' %');\n    }).on('mouseout', function (d) {\n      setHoverSent('');\n      divTooltip.style('display', 'none');\n    }); // Legend\n\n    /*\n    var legend = svg.selectAll(\".legend\")\n        .data(['Engegment','Sentiment'].slice())\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) { return \"translate(0,\" + i * 20 + \")\"; });\n     legend.append(\"rect\")\n        .attr(\"x\", width - 48)\n        .attr(\"width\", 18)\n        .attr(\"height\", 18)\n        .style(\"fill\", color);\n     legend.append(\"text\")\n        .attr(\"x\", width - 54)\n        .attr(\"y\", 9)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"end\")\n        .text(function(d) { return d; });\n        */\n\n    function wrap(text, width) {\n      text.each(function () {\n        var text = d3.select(this),\n            words = text.text().split(/\\s+/).reverse(),\n            word,\n            line = [],\n            lineNumber = 0,\n            lineHeight = 1.1,\n            // ems\n        y = text.attr(\"y\"),\n            dy = parseFloat(text.attr(\"dy\")),\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n\n        while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n\n          if (tspan.node().getComputedTextLength() > width) {\n            line.pop();\n            tspan.text(line.join(\" \"));\n            line = [word];\n            tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", `${++lineNumber * lineHeight + dy}em`).text(word);\n          }\n        }\n      });\n    }\n  }, [choosenSentiment]); // close useeffect\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"svg\", {\n      id: \"barChart\",\n      width: \"500\",\n      height: \"270\",\n      ref: d3Container\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 272,\n      columnNumber: 13\n    }, this)\n  }, void 0, false);\n};\n\n_s(BarChart, \"xFRMPr4wlNF5HttcQFtjqgXWot8=\");\n\n_c = BarChart;\nexport default BarChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"BarChart\");","map":{"version":3,"sources":["/Users/lovisaforsberg/MS_vis/ms_viz/src/components/barchart.js"],"names":["React","useContext","useEffect","useRef","useReducer","useState","createContext","d3","testData","SentimentContext","HoverSentContext","BarChart","SentSentimentContext","choosenSentiment","setChoosenSentiment","SentHoverSentContext","hoverSent","setHoverSent","d3Container","post_data","keys","sent","eng","stack_key_mapping","getPosts","data","push","name","pos","comments","postname","values","value","yoffset","yscale","total","neg","neu","likes","shares","children","forEach","child","handleHover","type","select","selectAll","remove","margin","top","right","bottom","left","width","height","divTooltip","append","attr","x0","scaleBand","domain","rangeRound","padding","x1","bandwidth","y0","scaleLinear","range","max","d","y1","color","scaleOrdinal","xAxis","axisBottom","ticks","yAxisLeft","axisLeft","tickFormat","parseInt","yAxisRight","axisRight","svg","current","call","style","text","graph","join","on","console","log","event","pageX","pageY","html","wrap","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dy","parseFloat","tspan","pop","node","getComputedTextLength"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport * as d3 from 'd3'\nimport '../../node_modules/@ibm/plex/css/ibm-plex.css';\nimport '../style/barchart.css'\nimport testData from '../data/sveaskog.csv'\nimport {SentimentContext} from '../App'\nimport {HoverSentContext} from './graphContainer'\n\n\n\nconst BarChart = () =>{\n\n    const SentSentimentContext = useContext(SentimentContext);\n    const {choosenSentiment, setChoosenSentiment} = SentSentimentContext\n\n    const SentHoverSentContext = useContext(HoverSentContext)\n    const {hoverSent, setHoverSent} = SentHoverSentContext\n\n    const d3Container = useRef(null)\n\n    var post_data = []\n    var keys = []\n    var sent = []\n    var eng = []\n  \n   var stack_key_mapping={\n    \"Positive\":\"Sentiment\",\n    \"Negative\":\"Sentiment\",\n    \"Neutral\":\"Sentiment\",\n    \"Comments\":\"Engagement\",\n    \"Likes\":\"Engagement\",\n    \"Shares\":\"Engagement\"};\n\n    const getPosts = (data) =>{\n        if (!('children' in data)){\n            keys.push(data.name)\n            sent.push(data.pos)\n            eng.push(data.comments)\n            post_data.push({\n                postname: data.name,\n                values: [\n                    //{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n                    //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n                    {name:'Positive', value:data.pos, yoffset: data.pos, yscale:1, total:(data.pos+data.neg+data.neu)},\n                    {name:'Negative', value:data.neg, yoffset:(data.neg+data.pos), yscale:1, total:(data.pos+data.neg+data.neu)},\n                    {name:'Neutral', value:data.neu, yoffset:(data.pos+data.neg+data.neu), yscale:1, total:(data.pos+data.neg+data.neu)},\n\n                    {name:'Comments', value:data.comments, yoffset: data.comments, yscale:0, total:(data.comments+data.likes+data.shares)},\n                    {name:'Likes', value:data.likes, yoffset:(data.comments+data.likes), yscale:0, total:(data.comments+data.likes+data.shares)},\n                    {name:'Shares', value:data.shares, yoffset: (data.comments+data.likes+data.shares), yscale:0, total:(data.comments+data.likes+data.shares)},\n                ]\n            })\n        }\n        else{\n            data.children.forEach(child =>{\n                getPosts(child)\n            })\n        }\n    }\n\n    const handleHover = (type) =>{\n        if(type === 'Likes' ||type === 'Comments' ||type === 'Shares'){\n            setHoverSent('eng')\n        }\n        else{\n            setHoverSent(type)\n        }\n    }\n\n    getPosts(choosenSentiment)\n\n    useEffect(()=>{\n\n        d3.select(\".root_barchart\").selectAll('*').remove()\n        d3.select(\".legend\").selectAll('*').remove()\n\n\n    var margin = {top: 20, right: 40, bottom: 30, left: 40},\n    width = 500 - margin.left - margin.right,\n    height = 250 - margin.top - margin.bottom;\n\n    var divTooltip = d3\n        .select('body')\n        .append('div')\n        .attr('class', 'toolTip')\n        .attr('font-size', '100px')\n\n    var x0 = d3.scaleBand()\n        .domain(keys)\n        .rangeRound([0, width])\n        .padding(0.4);\n\n    var x1 = d3.scaleBand()\n        .domain(['Engagement','Sentiment'])\n        .rangeRound([0, x0.bandwidth()])\n        .padding(0.05);\n\n    var y0 = d3.scaleLinear()\n        .range([height, 0])\n        //.domain([0,Math.max(...eng)]);\n        .domain([0, d3.max(post_data, function(d) { return d.values[3].value+d.values[4].value+d.values[5].value; })]);\n\n    var y1 = d3.scaleLinear()\n        .range([height, 0])\n        .domain([0,100]);\n        \n\n    var color = d3.scaleOrdinal(['#63A37B','#F15645', '#E5E5E5',\n                                '#005282', '#336D90', '#6692AC']);\n\n    var xAxis = d3.axisBottom(x0)\n        //.scale(x0)\n        .ticks(5);\n\n    var yAxisLeft = d3.axisLeft(y0)\n        //.scale(y0)\n        .tickFormat(function(d) { return parseInt(d)});\n\n    var yAxisRight = d3.axisRight(y1)\n       // .scale(y1)\n        .tickFormat(function(d) { return parseInt(d) });\n\n    var svg = d3.select(d3Container.current)\n        .attr('class', 'root_barchart')\n        .attr(\"preserveAspectRatio\", \"xMinYMin meet\")\n        .attr(\"viewBox\", \"0 0 300 300\")\n        .append(\"svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\n\n    // Ticks on x-axis and y-axis\n    svg.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        .call(xAxis)\n        //.selectAll(\".tick text\")\n        //.call(wrap, x0.bandwidth())\n        .selectAll(\"text\")\t\n        .style(\"text-anchor\", \"end\")\n        .attr(\"dx\", \"0.8em\")\n        .attr(\"dy\", \"1em\")\n        .attr('overflow', 'visible')\n        .attr(\"transform\", \"rotate(-25)\");\n\n    svg.append(\"g\")\n        .attr(\"class\", \"y0 axis\")\n        .call(yAxisLeft)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", 6)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"fill\", \"#005282\")\n        .text(\"Engagement\");\n\n    svg.select('.y0.axis')\n    .selectAll('.tick')\n    .attr('overflow', 'visible')\n\n        .style(\"fill\",\"#98abc5\");\n\n    svg.append(\"g\")\n        .attr(\"class\", \"y1 axis\")\n        .attr(\"transform\", \"translate(\" + width + \",0)\")\n        .call(yAxisRight)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", -16)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"fill\", \"#63A37B\")\n        .text(\"Sentiment\");\n\n    svg.select('.y1.axis')\n        .selectAll('.tick')\n        .style(\"fill\",\"#d0743c\");\n    // End ticks\n\n    var graph = svg.selectAll(\".date\")\n        .attr('class', 'graph')\n        .data(post_data)\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"g\")\n        .attr(\"transform\", function(d) { return \"translate(\" + x0(d.postname) + \",0)\"; });\n\n    graph.selectAll(\"rect\")\n        .data(function(d){return d.values})\n        .join('rect')\n        .attr(\"width\", x1.bandwidth())\n        .attr(\"x\", function(d) { return x1(stack_key_mapping[d.name]); })\n        .attr(\"y\", function(d) { return d.yscale==0 ? y0(d.yoffset) : y1(d.yoffset); })\n        .attr(\"height\", function(d) { return height - (d.yscale==0 ? y0(d.value) : y1(d.value)); })\n        .style(\"fill\", function(d) { return color(d.name); })\n        .style(\"cursor\", \"pointer\")\n        .on('mousemove', function(d){\n            console.log(d.name)\n            handleHover(d.name)\n            divTooltip\n            .style('left', d3.event.pageX+10+'px')\n            .style('top', d3.event.pageY-25+'px')\n            .style('display', 'inline-block')\n            .html(stack_key_mapping[d.name] === 'Engagement'?\n                'Total '+stack_key_mapping[d.name]+' '+d.total+'</br>'+d.name+': '+d.value:\n                d.name+': '+d.value+' %')\n        })\n        .on('mouseout', function(d){\n            setHoverSent('')\n          divTooltip.style('display', 'none')\n        })\n\n\n\n    // Legend\n    /*\n    var legend = svg.selectAll(\".legend\")\n        .data(['Engegment','Sentiment'].slice())\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) { return \"translate(0,\" + i * 20 + \")\"; });\n\n    legend.append(\"rect\")\n        .attr(\"x\", width - 48)\n        .attr(\"width\", 18)\n        .attr(\"height\", 18)\n        .style(\"fill\", color);\n\n    legend.append(\"text\")\n        .attr(\"x\", width - 54)\n        .attr(\"y\", 9)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"end\")\n        .text(function(d) { return d; });\n        */\n\n    function wrap(text, width) {\n        text.each(function() {\n        var text = d3.select(this),\n        words = text.text().split(/\\s+/).reverse(),\n        word,\n        line = [],\n        lineNumber = 0,\n        lineHeight = 1.1, // ems\n        y = text.attr(\"y\"),\n        dy = parseFloat(text.attr(\"dy\")),\n        tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\")\n        while (word = words.pop()) {\n            line.push(word)\n            tspan.text(line.join(\" \"))\n            if (tspan.node().getComputedTextLength() > width) {\n                line.pop()\n                tspan.text(line.join(\" \"))\n                line = [word]\n                tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", `${++lineNumber * lineHeight + dy}em`).text(word)\n            }\n        }\n        })\n    }\n\n\n    },[choosenSentiment]) // close useeffect\n\n    return(\n        <>\n            <svg id='barChart' width=\"500\" height=\"270\" ref={d3Container}></svg>\n\n        </>\n    )\n\n}\nexport default BarChart"]},"metadata":{},"sourceType":"module"}