{"ast":null,"code":"import _slicedToArray from\"/Users/lovisaforsberg/MS_vis/ms_viz/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useRef,useReducer,useState,createContext}from\"react\";import*as d3 from'd3';import'../../node_modules/@ibm/plex/css/ibm-plex.css';import'../style/barchart.css';import testData from'../data/sveaskog.csv';import{SentimentContext}from'../App';import{HoverSentContext}from'./graphContainer';import{allPostsContext}from'./graphContainer';import{HoverContext}from\"../App\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var BarChart=function BarChart(){var SentSentimentContext=useContext(SentimentContext);var choosenSentiment=SentSentimentContext.choosenSentiment,setChoosenSentiment=SentSentimentContext.setChoosenSentiment;var SentHoverSentContext=useContext(HoverSentContext);var hoverSent=SentHoverSentContext.hoverSent,setHoverSent=SentHoverSentContext.setHoverSent;var SentHoverContext=useContext(HoverContext);var hover=SentHoverContext.hover,setHover=SentHoverContext.setHover;//const [postData, setPostData] = useState([])\n//const [keys, setKeys] = useState([])\n//const [sent, setSent] = useState([])\n//const [eng, setEng] = useState([])\nvar _useState=useState(false),_useState2=_slicedToArray(_useState,2),showOnlyComments=_useState2[0],setShowOnlyComments=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),showComments=_useState4[0],setShowComments=_useState4[1];var _useState5=useState(true),_useState6=_slicedToArray(_useState5,2),showLikes=_useState6[0],setShowLikes=_useState6[1];var _useState7=useState(true),_useState8=_slicedToArray(_useState7,2),showShares=_useState8[0],setShowShares=_useState8[1];var d3Container=useRef(null);var post_data=[];var keys=[];var sent=[];var eng=[];var stack_key_mapping={\"Positive\":\"Sentiment\",\"Negative\":\"Sentiment\",\"Neutral\":\"Sentiment\",\"Comments\":\"Engagement\",\"Likes\":\"Engagement\",\"Shares\":\"Engagement\"};var getPosts=function getPosts(data,input){if(!('children'in data)){keys.push(data.name);sent.push(data.pos);eng.push(data.comments);post_data.push({postname:data.name,values:[//{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n//{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n{name:'Positive',value:data.pos,yoffset:data.pos,yscale:1,total:data.pos+data.neg+data.neu,postName:data.name},{name:'Negative',value:data.neg,yoffset:data.neg+data.pos,yscale:1,total:data.pos+data.neg+data.neu,postName:data.name},{name:'Neutral',value:data.neu,yoffset:data.pos+data.neg+data.neu,yscale:1,total:data.pos+data.neg+data.neu,postName:data.name},{name:'Comments',value:data.comments/data.followers*100,yoffset:data.comments/data.followers*100,yscale:0,total:(data.comments+data.likes+data.shares)/data.followers*100,postName:data.name,followers:data.followers},{name:'Likes',value:data.likes/data.followers*100,yoffset:(data.comments+data.likes)/data.followers*100,yscale:0,total:(data.comments+data.likes+data.shares)/data.followers*100,postName:data.name,followers:data.followers},{name:'Shares',value:data.shares/data.followers*100,yoffset:(data.comments+data.likes+data.shares)/data.followers*100,yscale:0,total:(data.comments+data.likes+data.shares)/data.followers*100,postName:data.name,followers:data.followers}]});}else{data.children.forEach(function(child){getPosts(child);});}};/*\n    const getPostsComment = (data) =>{\n        if (!('children' in data)){\n            keys.push(data.name)\n            sent.push(data.pos)\n            eng.push(data.comments)\n            post_data.push({\n                postname: data.name,\n                values: [\n                    //{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n                    //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n                    {name:'Positive', value:data.pos, yoffset: data.pos, yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Negative', value:data.neg, yoffset:(data.neg+data.pos), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Neutral', value:data.neu, yoffset:(data.pos+data.neg+data.neu), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n\n                    {name:'Comments', value:data.comments/(data.followers)*100, yoffset: data.comments/(data.followers)*100, yscale:0, total:data.comments/(data.followers)*100, postName:data.name, followers:data.followers},\n                    \n                ]\n            })\n        }\n        else{\n            data.children.forEach(child =>{\n                getPostsComment(child)\n            })\n        }\n    }\n    */var handleHover=function handleHover(type){if(type==='Likes'||type==='Comments'||type==='Shares'){setHoverSent('eng');}else{setHoverSent(type);}};var _useState9=useState('Show only comments'),_useState10=_slicedToArray(_useState9,2),btnText=_useState10[0],setBtnText=_useState10[1];var changeData=function changeData(){if(showOnlyComments===false){setShowOnlyComments(true);document.getElementById('change_button').className='groupButtonActive';setBtnText('Show all engagement');}else{setShowOnlyComments(false);document.getElementById('change_button').className='groupButtonInactive';setBtnText('Show only comments');}};var _useState11=useState('all'),_useState12=_slicedToArray(_useState11,2),barFilter=_useState12[0],setBarFilter=_useState12[1];var handleFilter=function handleFilter(data){if(barFilter===data){setBarFilter('all');}else{setBarFilter(data);}};getPosts(choosenSentiment);//getPostsComment(choosenSentiment)\nuseEffect(function(){d3.select(\".root_barchart\").selectAll('*').remove();d3.select(\".legend\").selectAll('*').remove();var margin={top:20,right:40,bottom:60,left:40},width=500-margin.left-margin.right,height=250-margin.top-margin.bottom;var divTooltip=d3.select('body').append('div').attr('class','toolTip').attr('font-size','100px');var x0=d3.scaleBand().domain(keys).rangeRound([0,width]).padding(0.4);var x1=d3.scaleBand().domain(['Engagement','Sentiment']).rangeRound([0,x0.bandwidth()]).padding(0.05);var y0=d3.scaleLinear().range([height,0])//.domain([0,Math.max(...eng)]);\n.domain([0,d3.max(post_data,function(d){return barFilter==='Comments'?d.values[3].value:barFilter==='Likes'?d.values[4].value:barFilter==='Shares'?d.values[5].value:d.values[3].value+d.values[4].value+d.values[5].value;})]);/*\n        .domain([0, d3.max(post_data, function(d) { return showOnlyComments ?d.values[3].value:\n             d.values[3].value+d.values[4].value+d.values[5].value; })]);\n             */ //.domain([0, d3.max(post_data, function(d) { return d.values[3].value})]);\nvar y1=d3.scaleLinear().range([height,0]).domain([0,100]);var color=d3.scaleOrdinal(['#63A37B','#F15645','#E5E5E5','#005282','#336D90','#6692AC']);var xAxis=d3.axisBottom(x0)//.scale(x0)\n.ticks(5);var yAxisLeft=d3.axisLeft(y0)//.scale(y0)\n.tickFormat(function(d){return d3.format(\".00001%\")(d/100);});var yAxisRight=d3.axisRight(y1)// .scale(y1)\n.tickFormat(function(d){return parseInt(d);});var svg=d3.select(d3Container.current).attr('class','root_barchart').append(\"svg\").attr(\"width\",width+margin.left+margin.right).attr(\"height\",height+margin.top+margin.bottom).append(\"g\").attr(\"transform\",\"translate(\"+margin.left+\",\"+margin.top+\")\");// Ticks on x-axis and y-axis\nvar xAxisG=svg.append(\"g\").attr(\"class\",\"x axis\").attr(\"transform\",\"translate(0,\"+height+\")\").call(xAxis)//.selectAll(\".tick text\")\n//.call(wrap, x0.bandwidth())\n.selectAll(\"text\").style(\"text-anchor\",\"end\").attr(\"dx\",\"1.2em\").attr(\"dy\",\"1em\").attr('overflow','visible').attr(\"transform\",\"rotate(-20)\")//.style('text-decoration', 'underline')\n.attr('fill','#4d4d4d');xAxisG.select(\".tick text\").attr('fill','#005282');svg.append(\"g\").attr(\"class\",\"y0 axis\").call(yAxisLeft).append(\"text\").attr(\"transform\",\"rotate(-90)\").attr(\"y\",6).attr(\"dy\",\".71em\").style(\"text-anchor\",\"end\").style(\"fill\",\"#005282\").text(\"Engagement rate\");svg.select('.x axis').selectAll('text').style(\"fill\",\"#07737F\");svg.append(\"g\").attr(\"class\",\"y1 axis\").attr(\"transform\",\"translate(\"+width+\",0)\").call(yAxisRight).append(\"text\").attr(\"transform\",\"rotate(-90)\").attr(\"y\",-16).attr(\"dy\",\".71em\").style(\"text-anchor\",\"end\").style(\"fill\",\"#63A37B\").text(\"Sentiment\");svg.select('.y1.axis').selectAll('.tick').style(\"fill\",\"#d0743c\");// End ticks\nvar graph=svg.selectAll(\".date\").attr('class','graph').data(post_data)//.enter()\n//.append(\"g\")\n.join('g').attr(\"class\",\"g\").attr(\"transform\",function(d){return\"translate(\"+x0(d.postname)+\",0)\";});graph.selectAll(\"rect\").data(function(d){return d.values;}).join('rect').attr(\"width\",x1.bandwidth()).attr(\"x\",function(d){return x1(stack_key_mapping[d.name]);})//.attr(\"y\", function(d) { return d.yscale==0 ?  y0(d.yoffset): y1(d.yoffset); })\n.attr(\"y\",function(d){return d.yscale==0?barFilter==='all'?y0(d.yoffset):y0(d.value):y1(d.yoffset);})//.attr(\"height\", function(d) { return height - (d.yscale==0 ? y0(d.value) : y1(d.value)); })\n/*\n        .attr(\"height\", function(d) { return showOnlyComments ? \n             height - (d.yscale==0 ? (d.name === 'Comments' ? y0(d.value) : height ): y1(d.value)):\n             height - (d.yscale==0 ? y0(d.value) : y1(d.value))\n             ; })\n        */.attr(\"height\",function(d){return height-(d.yscale==0?d.name===barFilter||'all'===barFilter?y0(d.value):height:y1(d.value));}).attr(\"fill-opacity\",function(d){return hover.length===0?1:hover.includes(d.postName)?1:0.5;}).style(\"fill\",function(d){return color(d.name);}).style(\"cursor\",\"pointer\").on('mousemove',function(d){handleHover(d.name);divTooltip.style('left',d3.event.pageX+10+'px').style('top',d3.event.pageY-25+'px').style('display','inline-block').html(stack_key_mapping[d.name]==='Engagement'?'<strong>'+d.postName+'</strong></br>'+stack_key_mapping[d.name]+' rate: '+d.total.toFixed(3)+'%'+'</br>'+d.name+': '+Math.round(d.value*d.followers)+' (rate: '+d.value.toFixed(3)+'%)':'<strong>'+d.postName+'</strong></br>'+d.name+': '+d.value+' %');}).on('mouseout',function(d){setHoverSent('');divTooltip.style('display','none');});//.on('mouseover', function(d){console.log(d.postName)})\n// Legend\nvar legend=svg.selectAll(\".legend\").data(['Comments','Likes','Shares'].slice())//.enter()\n//.append(\"g\")\n.join('g').attr(\"class\",\"legend\").attr(\"transform\",function(d,i){return\"translate(\"+i*60+\", 0)\";});legend.append(\"rect\")//.attr('x', function(d, i){return width -(20*i)})\n.attr(\"x\",margin.right+5).attr('y',-20).attr(\"width\",14).attr(\"height\",14).attr('class','legendRect Active').attr('cursor','pointer').style(\"fill\",color).attr('fill-opacity',function(d){return barFilter===d?1:barFilter==='all'?1:0.3;}).attr('id',function(d){return d;}).on('click',function(d){handleFilter(d);});legend.append(\"text\").attr(\"x\",margin.right).attr(\"y\",-14).attr(\"dy\",\".35em\").style(\"text-anchor\",\"end\").attr('fill-opacity',function(d){return barFilter===d?1:barFilter==='all'?1:0.5;}).text(function(d){return d;});var legend2=svg.selectAll(\".legend\").data(['Positive','Negative','Neutral'].slice())//.enter()\n//.append(\"g\")\n.join('g').attr(\"class\",\"legend\").attr(\"transform\",function(d,i){return\"translate(\"+i*60+\", 0)\";});legend2.append(\"rect\")//.attr('x', function(d, i){return width -(20*i)})\n.attr(\"x\",width-135).attr('y',-20).attr(\"width\",14).attr(\"height\",14).style(\"fill\",color);legend2.append(\"text\").attr(\"x\",width-140).attr(\"y\",-14).attr(\"dy\",\".35em\").style(\"text-anchor\",\"end\").text(function(d){return d;});function wrap(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1.1,// ems\ny=text.attr(\"y\"),dy=parseFloat(text.attr(\"dy\")),tspan=text.text(null).append(\"tspan\").attr(\"x\",0).attr(\"y\",y).attr(\"dy\",dy+\"em\");while(word=words.pop()){line.push(word);tspan.text(line.join(\" \"));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(\" \"));line=[word];tspan=text.append(\"tspan\").attr(\"x\",0).attr(\"y\",y).attr(\"dy\",\"\".concat(++lineNumber*lineHeight+dy,\"em\")).text(word);}}});}},[choosenSentiment,hover,barFilter]);// close useeffect\nreturn/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsx(\"div\",{className:\"barchartContainer\",children:/*#__PURE__*/_jsx(\"svg\",{id:\"barChart\",width:\"500\",height:\"270\",ref:d3Container})})});};export default BarChart;","map":{"version":3,"sources":["/Users/lovisaforsberg/MS_vis/ms_viz/src/components/barchart.js"],"names":["React","useContext","useEffect","useRef","useReducer","useState","createContext","d3","testData","SentimentContext","HoverSentContext","allPostsContext","HoverContext","BarChart","SentSentimentContext","choosenSentiment","setChoosenSentiment","SentHoverSentContext","hoverSent","setHoverSent","SentHoverContext","hover","setHover","showOnlyComments","setShowOnlyComments","showComments","setShowComments","showLikes","setShowLikes","showShares","setShowShares","d3Container","post_data","keys","sent","eng","stack_key_mapping","getPosts","data","input","push","name","pos","comments","postname","values","value","yoffset","yscale","total","neg","neu","postName","followers","likes","shares","children","forEach","child","handleHover","type","btnText","setBtnText","changeData","document","getElementById","className","barFilter","setBarFilter","handleFilter","select","selectAll","remove","margin","top","right","bottom","left","width","height","divTooltip","append","attr","x0","scaleBand","domain","rangeRound","padding","x1","bandwidth","y0","scaleLinear","range","max","d","y1","color","scaleOrdinal","xAxis","axisBottom","ticks","yAxisLeft","axisLeft","tickFormat","format","yAxisRight","axisRight","parseInt","svg","current","xAxisG","call","style","text","graph","join","length","includes","on","event","pageX","pageY","html","toFixed","Math","round","legend","slice","i","legend2","wrap","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dy","parseFloat","tspan","pop","node","getComputedTextLength"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport * as d3 from 'd3'\nimport '../../node_modules/@ibm/plex/css/ibm-plex.css';\nimport '../style/barchart.css'\nimport testData from '../data/sveaskog.csv'\nimport {SentimentContext} from '../App'\nimport {HoverSentContext} from './graphContainer'\nimport {allPostsContext} from './graphContainer'\nimport {HoverContext} from \"../App\";\n\n\nconst BarChart = () =>{\n\n    const SentSentimentContext = useContext(SentimentContext);\n    const {choosenSentiment, setChoosenSentiment} = SentSentimentContext\n\n    const SentHoverSentContext = useContext(HoverSentContext)\n    const {hoverSent, setHoverSent} = SentHoverSentContext\n\n    const SentHoverContext = useContext(HoverContext);\n    const {hover, setHover} = SentHoverContext\n\n    //const [postData, setPostData] = useState([])\n    //const [keys, setKeys] = useState([])\n    //const [sent, setSent] = useState([])\n    //const [eng, setEng] = useState([])\n\n    const [showOnlyComments, setShowOnlyComments] = useState(false)\n\n    const [showComments, setShowComments] = useState(true)\n    const [showLikes, setShowLikes] = useState(true)\n    const [showShares, setShowShares] = useState(true)\n\n\n    const d3Container = useRef(null)\n\n    var post_data = []\n    var keys = []\n    var sent = []\n    var eng = []\n  \n   var stack_key_mapping={\n    \"Positive\":\"Sentiment\",\n    \"Negative\":\"Sentiment\",\n    \"Neutral\":\"Sentiment\",\n    \"Comments\":\"Engagement\",\n    \"Likes\":\"Engagement\",\n    \"Shares\":\"Engagement\"};\n\n    const getPosts = (data, input) =>{\n        if (!('children' in data)){\n            keys.push(data.name)\n            sent.push(data.pos)\n            eng.push(data.comments)\n            post_data.push({\n                postname: data.name,\n                values: [\n                    //{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n                    //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n                    {name:'Positive', value:data.pos, yoffset: data.pos, yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Negative', value:data.neg, yoffset:(data.neg+data.pos), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Neutral', value:data.neu, yoffset:(data.pos+data.neg+data.neu), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n\n                    {name:'Comments', value:data.comments/(data.followers)*100, yoffset: data.comments/(data.followers)*100, yscale:0, total:(data.comments+data.likes+data.shares)/(data.followers)*100, postName:data.name, followers:data.followers},\n                    {name:'Likes', value:data.likes/(data.followers)*100, yoffset:(data.comments+data.likes)/(data.followers)*100, yscale:0, total:(data.comments+data.likes+data.shares)/(data.followers)*100, postName:data.name, followers:data.followers},\n                    {name:'Shares', value:data.shares/(data.followers)*100, yoffset: (data.comments+data.likes+data.shares)/(data.followers)*100, yscale:0, total:(data.comments+data.likes+data.shares)/(data.followers)*100, postName:data.name, followers:data.followers},\n                ]\n            })\n        }\n        else{\n            data.children.forEach(child =>{\n                getPosts(child)\n            })\n        }\n    }\n\n    /*\n    const getPostsComment = (data) =>{\n        if (!('children' in data)){\n            keys.push(data.name)\n            sent.push(data.pos)\n            eng.push(data.comments)\n            post_data.push({\n                postname: data.name,\n                values: [\n                    //{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n                    //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n                    {name:'Positive', value:data.pos, yoffset: data.pos, yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Negative', value:data.neg, yoffset:(data.neg+data.pos), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Neutral', value:data.neu, yoffset:(data.pos+data.neg+data.neu), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n\n                    {name:'Comments', value:data.comments/(data.followers)*100, yoffset: data.comments/(data.followers)*100, yscale:0, total:data.comments/(data.followers)*100, postName:data.name, followers:data.followers},\n                    \n                ]\n            })\n        }\n        else{\n            data.children.forEach(child =>{\n                getPostsComment(child)\n            })\n        }\n    }\n    */\n\n    const handleHover = (type) =>{\n        if(type === 'Likes' ||type === 'Comments' ||type === 'Shares'){\n            setHoverSent('eng')\n        }\n        else{\n            setHoverSent(type)\n        }\n    }\n\n    const [btnText, setBtnText] = useState('Show only comments')\n    const changeData = () =>{\n        if(showOnlyComments === false){\n            setShowOnlyComments(true)\n            document.getElementById('change_button').className = 'groupButtonActive'\n            setBtnText('Show all engagement')\n\n        }\n        else{\n            setShowOnlyComments(false)\n            document.getElementById('change_button').className = 'groupButtonInactive'\n            setBtnText('Show only comments')\n        }\n    } \n\n    const [barFilter, setBarFilter] = useState('all')\n\n    const handleFilter = (data) =>{\n        if(barFilter === data){\n            setBarFilter('all')\n            \n        }\n        else{\n            setBarFilter(data)\n        }\n    }\n    \n    getPosts(choosenSentiment)\n    //getPostsComment(choosenSentiment)\n\n\n    useEffect(()=>{\n        d3.select(\".root_barchart\").selectAll('*').remove()\n        d3.select(\".legend\").selectAll('*').remove()\n\n    var margin = {top: 20, right: 40, bottom: 60, left: 40},\n    width = 500 - margin.left - margin.right,\n    height = 250 - margin.top - margin.bottom;\n\n    var divTooltip = d3\n        .select('body')\n        .append('div')\n        .attr('class', 'toolTip')\n        .attr('font-size', '100px')\n\n    var x0 = d3.scaleBand()\n        .domain(keys)\n        .rangeRound([0, width])\n        .padding(0.4);\n\n    var x1 = d3.scaleBand()\n        .domain(['Engagement','Sentiment'])\n        .rangeRound([0, x0.bandwidth()])\n        .padding(0.05);\n\n    var y0 = d3.scaleLinear()\n        .range([height, 0])\n        //.domain([0,Math.max(...eng)]);\n        .domain([0, d3.max(post_data, function(d){return barFilter==='Comments' ? d.values[3].value :\n            barFilter==='Likes' ? d.values[4].value :\n            barFilter==='Shares' ? d.values[5].value :\n            d.values[3].value+d.values[4].value+d.values[5].value \n        })])\n        /*\n        .domain([0, d3.max(post_data, function(d) { return showOnlyComments ?d.values[3].value:\n             d.values[3].value+d.values[4].value+d.values[5].value; })]);\n             */\n        //.domain([0, d3.max(post_data, function(d) { return d.values[3].value})]);\n\n\n    var y1 = d3.scaleLinear()\n        .range([height, 0])\n        .domain([0,100]);\n        \n\n    var color = d3.scaleOrdinal(['#63A37B','#F15645', '#E5E5E5',\n                                '#005282', '#336D90', '#6692AC']);\n\n    var xAxis = d3.axisBottom(x0)\n        //.scale(x0)\n        .ticks(5);\n\n    var yAxisLeft = d3.axisLeft(y0)\n        //.scale(y0)\n        .tickFormat(function(d) {return d3.format(\".00001%\")(d/100)});\n\n    var yAxisRight = d3.axisRight(y1)\n       // .scale(y1)\n        .tickFormat(function(d) { return parseInt(d) });\n\n    var svg = d3.select(d3Container.current)\n        .attr('class', 'root_barchart')\n   \n        .append(\"svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\n\n    // Ticks on x-axis and y-axis\n    var xAxisG = svg.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        \n        .call(xAxis)\n        //.selectAll(\".tick text\")\n        //.call(wrap, x0.bandwidth())\n        .selectAll(\"text\")\n        .style(\"text-anchor\", \"end\")\n        .attr(\"dx\", \"1.2em\")\n        .attr(\"dy\", \"1em\")\n        .attr('overflow', 'visible')\n        .attr(\"transform\", \"rotate(-20)\")\n        //.style('text-decoration', 'underline')\n        .attr('fill', '#4d4d4d')\n\n        xAxisG.select(\".tick text\")\n        .attr('fill', '#005282');\n\n    svg.append(\"g\")\n        .attr(\"class\", \"y0 axis\")\n        .call(yAxisLeft)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", 6)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"fill\", \"#005282\")\n        .text(\"Engagement rate\");\n\n\n    svg.select('.x axis')\n    .selectAll('text')\n    .style(\"fill\",\"#07737F\");\n\n    svg.append(\"g\")\n        .attr(\"class\", \"y1 axis\")\n        .attr(\"transform\", \"translate(\" + width + \",0)\")\n        .call(yAxisRight)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", -16)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"fill\", \"#63A37B\")\n        .text(\"Sentiment\");\n\n    svg.select('.y1.axis')\n        .selectAll('.tick')\n        .style(\"fill\",\"#d0743c\");\n    // End ticks\n\n    var graph = svg.selectAll(\".date\")\n        .attr('class', 'graph')\n        .data(post_data)\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"g\")\n        .attr(\"transform\", function(d) { return \"translate(\" + x0(d.postname) + \",0)\"; });\n        \n    graph.selectAll(\"rect\")\n        .data(function(d){return d.values})\n        .join('rect')\n        .attr(\"width\", x1.bandwidth())\n        .attr(\"x\", function(d) { return x1(stack_key_mapping[d.name]); })\n        //.attr(\"y\", function(d) { return d.yscale==0 ?  y0(d.yoffset): y1(d.yoffset); })\n\n        .attr(\"y\", function(d) { return d.yscale==0 ?  \n            barFilter === 'all' ? y0(d.yoffset) : y0(d.value)\n            : y1(d.yoffset); })\n\n\n        //.attr(\"height\", function(d) { return height - (d.yscale==0 ? y0(d.value) : y1(d.value)); })\n\n        /*\n        .attr(\"height\", function(d) { return showOnlyComments ? \n             height - (d.yscale==0 ? (d.name === 'Comments' ? y0(d.value) : height ): y1(d.value)):\n             height - (d.yscale==0 ? y0(d.value) : y1(d.value))\n             ; })\n        */\n       \n        .attr(\"height\", function(d) { return height - (d.yscale==0 ? \n            d.name === barFilter || 'all' === barFilter ? y0(d.value) : height\n            \n            : y1(d.value)); })\n\n        .attr(\"fill-opacity\", \n           (d)=> hover.length === 0 ? 1 : hover.includes(d.postName) ? 1 : 0.5\n        )\n        .style(\"fill\", function(d) { return color(d.name); })\n        .style(\"cursor\", \"pointer\")\n        .on('mousemove', function(d){\n            handleHover(d.name)\n            divTooltip\n            .style('left', d3.event.pageX+10+'px')\n            .style('top', d3.event.pageY-25+'px')\n            .style('display', 'inline-block')\n            .html(stack_key_mapping[d.name] === 'Engagement'?\n                '<strong>'+d.postName+'</strong></br>'+\n                stack_key_mapping[d.name]+' rate: '+(d.total).toFixed(3)+'%'+'</br>'+d.name+': '+Math.round((d.value)*(d.followers))+' (rate: '+(d.value).toFixed(3)+'%)':\n                '<strong>'+d.postName+'</strong></br>'+d.name+': '+d.value+' %')\n        })\n        .on('mouseout', function(d){\n            setHoverSent('')\n          divTooltip.style('display', 'none')\n        })\n        //.on('mouseover', function(d){console.log(d.postName)})\n\n\n        \n\n    // Legend\n    \n    var legend = svg.selectAll(\".legend\")\n        .data(['Comments', 'Likes', 'Shares'].slice())\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) { return \"translate(\" + i * 60 + \", 0)\"; });\n\n    legend.append(\"rect\")\n        //.attr('x', function(d, i){return width -(20*i)})\n        .attr(\"x\", margin.right +5)\n        .attr('y', -20)\n        .attr(\"width\", 14)\n        .attr(\"height\", 14)\n        .attr('class', 'legendRect Active')\n        .attr('cursor', 'pointer')\n        .style(\"fill\", color)\n        .attr('fill-opacity', function(d){return barFilter === d ? 1:\n            barFilter === 'all' ? 1: 0.3})\n        .attr('id', function(d){return d})\n        .on('click', function(d){handleFilter(d)})\n\n\n    legend.append(\"text\")\n        .attr(\"x\", margin.right)\n        .attr(\"y\", -14)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"end\")\n        .attr('fill-opacity', function(d){return barFilter === d ? 1:\n            barFilter === 'all' ? 1: 0.5})        \n        .text(function(d) { return d; });\n\n    var legend2 = svg.selectAll(\".legend\")\n        .data(['Positive', 'Negative', 'Neutral'].slice())\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) { return \"translate(\" + i * 60 + \", 0)\"; });\n\n    legend2.append(\"rect\")\n        //.attr('x', function(d, i){return width -(20*i)})\n        .attr(\"x\", width -135)\n        .attr('y', -20)\n        .attr(\"width\", 14)\n        .attr(\"height\", 14)\n        .style(\"fill\", color)\n\n    legend2.append(\"text\")\n        .attr(\"x\", width-140)\n        .attr(\"y\", -14)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"end\")\n        .text(function(d) { return d; });\n        \n\n    function wrap(text, width) {\n        text.each(function() {\n        var text = d3.select(this),\n        words = text.text().split(/\\s+/).reverse(),\n        word,\n        line = [],\n        lineNumber = 0,\n        lineHeight = 1.1, // ems\n        y = text.attr(\"y\"),\n        dy = parseFloat(text.attr(\"dy\")),\n        tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\")\n        while (word = words.pop()) {\n            line.push(word)\n            tspan.text(line.join(\" \"))\n            if (tspan.node().getComputedTextLength() > width) {\n                line.pop()\n                tspan.text(line.join(\" \"))\n                line = [word]\n                tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", `${++lineNumber * lineHeight + dy}em`).text(word)\n            }\n        }\n        })\n    }\n\n\n    },[choosenSentiment, hover, barFilter]) // close useeffect\n\n    return(\n        <>\n        <div className='barchartContainer'>\n \n                <svg id='barChart' width=\"500\" height=\"270\" ref={d3Container}></svg>\n        </div>\n\n        </>\n    )\n\n}\nexport default BarChart"]},"metadata":{},"sourceType":"module"}