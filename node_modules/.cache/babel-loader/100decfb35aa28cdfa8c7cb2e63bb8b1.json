{"ast":null,"code":"import React,{useContext,useEffect,useRef,useReducer,useState,createContext}from\"react\";import*as d3 from'd3';import testData from'../data/test.csv';import{jsx as _jsx}from\"react/jsx-runtime\";var AreaChart=function AreaChart(){var d3Container=useRef(null);useEffect(function(){d3.select(\".root\").selectAll('*').remove();var margin={top:20,right:30,bottom:30,left:40},width=960-margin.left-margin.right,height=500-margin.top-margin.bottom;var y=d3.scaleLinear().rangeRound([height,0]).nice();var x=d3.scaleBand().rangeRound([0,width]).paddingInner(0.05).align(0.1);var z=d3.scaleOrdinal(['#63A37B','#F15645','#7D7D7D']);// Date format https://bl.ocks.org/zanarmstrong/ca0adb7e426c12c06a95\nvar parseTime=d3.timeParse(\"%b %Y\");// Load stocks data\n// Ex: 0: {symbol: \"MSFT\", date: \"Jan 2000\", price: \"39.81\"}\nd3.csv('https://raw.githubusercontent.com/LyonDataViz/MOS5.5-Dataviz/master/data/stocks.csv').then(function(raw){var symbols=[];var data=[];// Data pre-processing\nraw.forEach(function(d,i){if(symbols.indexOf(d.symbol)<0){symbols.push(d.symbol);data[symbols.indexOf(d.symbol)]=[];}// String to INT\nd.value=+d.price;// Parsing time\nd.date=parseTime(d.date);data[symbols.indexOf(d.symbol)].push(d);});var data_nest=d3.nest().key(function(d){return d.date.getFullYear();}).key(function(d){return d.symbol;}).rollup(function(v){return d3.sum(v,function(d){return d.price;});}).entries(raw);var years=data_nest.map(function(d){return d.key;});// d3-stack format https://github.com/d3/d3-shape/blob/master/README.md#stack_keys\n// {MSFT: 356.07999999999987, AMZN: 527.17, IBM: 1162.97, AAPL: 260.98}\nvar data_stack=[];data_nest.forEach(function(d,i){d.values=d.values.map(function(e){return e.value;});var t={};symbols.forEach(function(e,i){t[e]=d.values[i];});t.year=d.key;data_stack.push(t);});var layers=d3.stack().keys(symbols)(data_stack);var max=d3.max(layers[layers.length-1],function(d){return d[1];});y.domain([0,max]);x.domain(years);console.log(symbols);console.log(data_stack);console.log(layers);var svg=d3.select(d3Container.current).attr('class','root').append(\"svg\").attr(\"width\",width+margin.left+margin.right).attr(\"height\",height+margin.top+margin.bottom).append(\"g\").attr(\"transform\",\"translate(\"+margin.left+\",\"+margin.top+\")\");svg.append(\"g\").selectAll(\"g\").data(layers).enter().append(\"g\").style(\"fill\",function(d){return z(d.key);}).selectAll(\"rect\").data(function(d){return d;}).enter().append(\"rect\").attr(\"x\",function(d,i){return x(d.data.year);}).attr(\"y\",function(d){return y(d[1]);}).attr(\"height\",function(d){return y(d[0])-y(d[1]);}).attr(\"width\",x.bandwidth());svg.append(\"g\").attr(\"class\",\"x axis\").attr(\"transform\",\"translate(0,\"+height+\")\").call(d3.axisBottom(x));svg.append(\"g\").attr(\"class\",\"y axis\").attr(\"transform\",\"translate(\"+0+\", 0)\").call(d3.axisLeft().scale(y));});},[]);// close useEffect\nreturn/*#__PURE__*/_jsx(\"svg\",{id:\"areaChart\",width:600,height:400,ref:d3Container});};// close Areachart component\nexport default AreaChart;","map":{"version":3,"sources":["/Users/lovisaforsberg/MS_vis/ms_viz/src/components/area_chart.js"],"names":["React","useContext","useEffect","useRef","useReducer","useState","createContext","d3","testData","AreaChart","d3Container","select","selectAll","remove","margin","top","right","bottom","left","width","height","y","scaleLinear","rangeRound","nice","x","scaleBand","paddingInner","align","z","scaleOrdinal","parseTime","timeParse","csv","then","raw","symbols","data","forEach","d","i","indexOf","symbol","push","value","price","date","data_nest","nest","key","getFullYear","rollup","v","sum","entries","years","map","data_stack","values","e","t","year","layers","stack","keys","max","length","domain","console","log","svg","current","attr","append","enter","style","bandwidth","call","axisBottom","axisLeft","scale"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport * as d3 from 'd3'\nimport testData from '../data/test.csv'\n\n\nconst AreaChart = ()=> {\n\n    const d3Container = useRef(null)\n\n    useEffect(()=>{\n    \n    d3.select(\".root\").selectAll('*').remove()\n\n    var margin = {top: 20, right: 30, bottom: 30, left: 40},\n    width = 960 - margin.left - margin.right,\n    height = 500 - margin.top - margin.bottom;\n\nvar y = d3.scaleLinear()\n    .rangeRound([height, 0])\n\t\t.nice();\n\nvar x = d3.scaleBand()\n    .rangeRound([0, width])\n    .paddingInner(0.05)\n    .align(0.1)\n    \n    var z = d3.scaleOrdinal(['#63A37B','#F15645', '#7D7D7D']);\n\n  // Date format https://bl.ocks.org/zanarmstrong/ca0adb7e426c12c06a95\n  var parseTime  = d3.timeParse(\"%b %Y\")\n  \n  \n    // Load stocks data\n  // Ex: 0: {symbol: \"MSFT\", date: \"Jan 2000\", price: \"39.81\"}\n  d3.csv('https://raw.githubusercontent.com/LyonDataViz/MOS5.5-Dataviz/master/data/stocks.csv').then(raw =>{ \n    \n    var symbols = [];\n    var data = []\n    \n    // Data pre-processing\n    raw.forEach(function(d, i) {\n      \n      if(symbols.indexOf(d.symbol) < 0) {\n        symbols.push(d.symbol)\n        data[symbols.indexOf(d.symbol)] = [];\n      }\n      \n      // String to INT\n      d.value = +d.price;     \n \n      // Parsing time\n      d.date = parseTime(d.date)\n      data[symbols.indexOf(d.symbol)].push(d);\n    });\n    \n    var data_nest = d3.nest()\n    \t.key(function(d) { return d.date.getFullYear(); })\n    \t.key(function(d) { return d.symbol; })\n    \t.rollup(function(v) { return d3.sum(v, function(d) { return d.price; }); })\n\t\t\t.entries(raw);\n    \n    var years = data_nest.map(function(d) { return d.key; })\n    \n    // d3-stack format https://github.com/d3/d3-shape/blob/master/README.md#stack_keys\n    // {MSFT: 356.07999999999987, AMZN: 527.17, IBM: 1162.97, AAPL: 260.98}\n    var data_stack = []\n    \n    data_nest.forEach(function(d, i) {\n      d.values = d.values.map(function(e) { return e.value; })\n      var t ={}\n      symbols.forEach(function(e, i) {\n        t[e] = d.values[i]\n      })\n      t.year = d.key;\n      data_stack.push(t)\n    })\n    \n    \n    var layers = d3.stack().keys(symbols)(data_stack);\n\n    var max = d3.max(layers[layers.length-1], function(d) { return d[1]; });\n    \n    y.domain([0, max]);\n    x.domain(years);\n    \n    console.log(symbols)\n    console.log(data_stack)\n    console.log(layers)\n    \n    var svg = d3.select(d3Container.current)\n    .attr('class', 'root')\n      .append(\"svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n      .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n    svg.append(\"g\").selectAll(\"g\")\n          .data(layers)\n      .enter().append(\"g\")\n        .style(\"fill\", function(d) { return z(d.key); })\t\n        .selectAll(\"rect\")\n      .data(function(d) {  return d; })\n        .enter().append(\"rect\")\n          .attr(\"x\", function(d, i) { return x(d.data.year); })\n          .attr(\"y\", function(d) { return y(d[1]); })\n          .attr(\"height\", function(d) { return y(d[0]) - y(d[1]); })\n          .attr(\"width\", x.bandwidth());\n    \n    svg.append(\"g\")\n      .attr(\"class\", \"x axis\")\n      .attr(\"transform\", \"translate(0,\" + height + \")\")\n      .call(d3.axisBottom(x))\n    \n    svg.append(\"g\")\n      .attr(\"class\", \"y axis\")\n      .attr(\"transform\", \"translate(\" + (0) + \", 0)\")\n      .call(d3.axisLeft().scale(y))\n    \n    })\n\n\n\n    }, []) // close useEffect\n\n    return(\n        <svg id='areaChart' width={600} height={400} ref={d3Container}></svg>\n    )\n\n} // close Areachart component\nexport default AreaChart; \n"]},"metadata":{},"sourceType":"module"}