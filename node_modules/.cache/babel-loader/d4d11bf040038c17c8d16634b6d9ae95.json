{"ast":null,"code":"var _jsxFileName = \"/Users/lovisaforsberg/MS_vis/ms_viz/src/components/barchart.js\",\n    _s = $RefreshSig$();\n\nimport React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport * as d3 from 'd3';\nimport '../../node_modules/@ibm/plex/css/ibm-plex.css';\nimport '../style/barchart.css';\nimport testData from '../data/sveaskog.csv';\nimport { SentimentContext } from '../App';\nimport { HoverSentContext } from './graphContainer';\nimport { allPostsContext } from './graphContainer';\nimport { HoverContext } from \"../App\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\n\nconst BarChart = () => {\n  _s();\n\n  const SentSentimentContext = useContext(SentimentContext);\n  const {\n    choosenSentiment,\n    setChoosenSentiment\n  } = SentSentimentContext;\n  const SentHoverSentContext = useContext(HoverSentContext);\n  const {\n    hoverSent,\n    setHoverSent\n  } = SentHoverSentContext;\n  const SentHoverContext = useContext(HoverContext);\n  const {\n    hover,\n    setHover\n  } = SentHoverContext;\n  console.log('hej'); //const [postData, setPostData] = useState([])\n  //const [keys, setKeys] = useState([])\n  //const [sent, setSent] = useState([])\n  //const [eng, setEng] = useState([])\n  //const [input, setInput] = useState('all')\n\n  const d3Container = useRef(null);\n  var post_data = [];\n  var keys = [];\n  var sent = [];\n  var eng = [];\n  var stack_key_mapping = {\n    \"Positive\": \"Sentiment\",\n    \"Negative\": \"Sentiment\",\n    \"Neutral\": \"Sentiment\",\n    \"Comments\": \"Engagement\",\n    \"Likes\": \"Engagement\",\n    \"Shares\": \"Engagement\"\n  };\n\n  const getPosts = (data, input) => {\n    if (!('children' in data)) {\n      keys.push(data.name);\n      sent.push(data.pos);\n      eng.push(data.comments);\n      post_data.push({\n        postname: data.name,\n        values: [//{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n        //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n        {\n          name: 'Positive',\n          value: data.pos,\n          yoffset: data.pos,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu,\n          postName: data.name\n        }, {\n          name: 'Negative',\n          value: data.neg,\n          yoffset: data.neg + data.pos,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu,\n          postName: data.name\n        }, {\n          name: 'Neutral',\n          value: data.neu,\n          yoffset: data.pos + data.neg + data.neu,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu,\n          postName: data.name\n        }, {\n          name: 'Comments',\n          value: data.comments / data.followers * 100,\n          yoffset: data.comments / data.followers * 100,\n          yscale: 0,\n          total: (data.comments + data.likes + data.shares) / data.followers * 100,\n          postName: data.name,\n          followers: data.followers\n        }, {\n          name: 'Likes',\n          value: data.likes / data.followers * 100,\n          yoffset: (data.comments + data.likes) / data.followers * 100,\n          yscale: 0,\n          total: (data.comments + data.likes + data.shares) / data.followers * 100,\n          postName: data.name,\n          followers: data.followers\n        }, {\n          name: 'Shares',\n          value: data.shares / data.followers * 100,\n          yoffset: (data.comments + data.likes + data.shares) / data.followers * 100,\n          yscale: 0,\n          total: (data.comments + data.likes + data.shares) / data.followers * 100,\n          postName: data.name,\n          followers: data.followers\n        }]\n      });\n    } else {\n      data.children.forEach(child => {\n        getPosts(child);\n      });\n    }\n  };\n\n  const getPostsComment = data => {\n    if (!('children' in data)) {\n      keys.push(data.name);\n      sent.push(data.pos);\n      eng.push(data.comments);\n      post_data.push({\n        postname: data.name,\n        values: [//{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n        //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n        {\n          name: 'Positive',\n          value: data.pos,\n          yoffset: data.pos,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu,\n          postName: data.name\n        }, {\n          name: 'Negative',\n          value: data.neg,\n          yoffset: data.neg + data.pos,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu,\n          postName: data.name\n        }, {\n          name: 'Neutral',\n          value: data.neu,\n          yoffset: data.pos + data.neg + data.neu,\n          yscale: 1,\n          total: data.pos + data.neg + data.neu,\n          postName: data.name\n        }, {\n          name: 'Comments',\n          value: data.comments / data.followers * 100,\n          yoffset: data.comments / data.followers * 100,\n          yscale: 0,\n          total: data.comments / data.followers * 100,\n          postName: data.name,\n          followers: data.followers\n        }]\n      });\n    } else {\n      data.children.forEach(child => {\n        getPostsComment(child);\n      });\n    }\n  };\n\n  const handleHover = type => {\n    if (type === 'Likes' || type === 'Comments' || type === 'Shares') {\n      setHoverSent('eng');\n    } else {\n      setHoverSent(type);\n    }\n  };\n\n  const changeData = chosen => {\n    if (chosen === 'comment') {//setInput('comment')\n    }\n  };\n\n  getPosts(choosenSentiment); //getPostsComment(choosenSentiment)\n\n  /*\n  const createData = (input) =>{\n      var post_data = []\n      var keys = []\n      var sent = []\n      var eng = []\n      if(input === 'all'){\n          getPosts(choosenSentiment, post_data, keys, sent, eng)\n      }\n      else if( input === 'comment'){\n          getPostsComment(choosenSentiment, post_data, keys, sent, eng)\n      }\n      \n      setPostData(post_data)\n      setKeys(keys)\n      setSent(sent)\n      setEng(eng)\n   }\n  */\n\n  useEffect(() => {\n    d3.select(\".root_barchart\").selectAll('*').remove();\n    d3.select(\".legend\").selectAll('*').remove();\n    var margin = {\n      top: 20,\n      right: 40,\n      bottom: 60,\n      left: 40\n    },\n        width = 500 - margin.left - margin.right,\n        height = 250 - margin.top - margin.bottom;\n    var divTooltip = d3.select('body').append('div').attr('class', 'toolTip').attr('font-size', '100px');\n    var x0 = d3.scaleBand().domain(keys).rangeRound([0, width]).padding(0.4);\n    var x1 = d3.scaleBand().domain(['Engagement', 'Sentiment']).rangeRound([0, x0.bandwidth()]).padding(0.05);\n    var y0 = d3.scaleLinear().range([height, 0]) //.domain([0,Math.max(...eng)]);\n    .domain([0, d3.max(post_data, function (d) {\n      return d.values[3].value + d.values[4].value + d.values[5].value;\n    })]); //.domain([0, d3.max(post_data, function(d) { return d.values[3].value})]);\n\n    var y1 = d3.scaleLinear().range([height, 0]).domain([0, 100]);\n    var color = d3.scaleOrdinal(['#63A37B', '#F15645', '#E5E5E5', '#005282', '#336D90', '#6692AC']);\n    var xAxis = d3.axisBottom(x0) //.scale(x0)\n    .ticks(5);\n    var yAxisLeft = d3.axisLeft(y0) //.scale(y0)\n    .tickFormat(function (d) {\n      return d3.format(\".00001%\")(d / 100);\n    });\n    var yAxisRight = d3.axisRight(y1) // .scale(y1)\n    .tickFormat(function (d) {\n      return parseInt(d);\n    });\n    var svg = d3.select(d3Container.current).attr('class', 'root_barchart').append(\"svg\").attr(\"width\", width + margin.left + margin.right).attr(\"height\", height + margin.top + margin.bottom).append(\"g\").attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\"); // Ticks on x-axis and y-axis\n\n    var xAxisG = svg.append(\"g\").attr(\"class\", \"x axis\").attr(\"transform\", \"translate(0,\" + height + \")\").call(xAxis) //.selectAll(\".tick text\")\n    //.call(wrap, x0.bandwidth())\n    .selectAll(\"text\").style(\"text-anchor\", \"end\").attr(\"dx\", \"1.2em\").attr(\"dy\", \"1em\").attr('overflow', 'visible').attr(\"transform\", \"rotate(-20)\") //.style('text-decoration', 'underline')\n    .attr('fill', '#4d4d4d');\n    xAxisG.select(\".tick text\").attr('fill', '#005282');\n    svg.append(\"g\").attr(\"class\", \"y0 axis\").call(yAxisLeft).append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"y\", 6).attr(\"dy\", \".71em\").style(\"text-anchor\", \"end\").style(\"fill\", \"#005282\").text(\"Engagement rate\");\n    svg.select('.x axis').selectAll('text').style(\"fill\", \"#07737F\");\n    svg.append(\"g\").attr(\"class\", \"y1 axis\").attr(\"transform\", \"translate(\" + width + \",0)\").call(yAxisRight).append(\"text\").attr(\"transform\", \"rotate(-90)\").attr(\"y\", -16).attr(\"dy\", \".71em\").style(\"text-anchor\", \"end\").style(\"fill\", \"#63A37B\").text(\"Sentiment\");\n    svg.select('.y1.axis').selectAll('.tick').style(\"fill\", \"#d0743c\"); // End ticks\n\n    var graph = svg.selectAll(\".date\").attr('class', 'graph').data(post_data) //.enter()\n    //.append(\"g\")\n    .join('g').attr(\"class\", \"g\").attr(\"transform\", function (d) {\n      return \"translate(\" + x0(d.postname) + \",0)\";\n    });\n    graph.selectAll(\"rect\").data(function (d) {\n      return d.values;\n    }).join('rect').attr(\"width\", x1.bandwidth()).attr(\"x\", function (d) {\n      return x1(stack_key_mapping[d.name]);\n    }) //.attr(\"y\", function(d) { return d.yscale==0 ?  y0(d.yoffset): y1(d.yoffset); })\n    .attr(\"y\", function (d) {\n      return d.yscale == 0 ? y0(d.yoffset) : y1(d.yoffset);\n    }) //.attr(\"height\", function(d) { return height - (d.yscale==0 ? y0(d.value) : y1(d.value)); })\n    .attr(\"height\", function (d) {\n      return height - (d.yscale == 0 ? d.name === 'Comments' ? y0(d.value) : null : y1(d.value));\n    }).attr(\"fill-opacity\", d => hover.length === 0 ? 1 : hover.includes(d.postName) ? 1 : 0.5).style(\"fill\", function (d) {\n      return color(d.name);\n    }).style(\"cursor\", \"pointer\").on('mousemove', function (d) {\n      handleHover(d.name);\n      divTooltip.style('left', d3.event.pageX + 10 + 'px').style('top', d3.event.pageY - 25 + 'px').style('display', 'inline-block').html(stack_key_mapping[d.name] === 'Engagement' ? stack_key_mapping[d.name] + ' rate: ' + d.total.toFixed(3) + '%' + '</br>' + d.name + ': ' + Math.round(d.value * d.followers) + ' (rate: ' + d.value.toFixed(3) + '%)' : d.name + ': ' + d.value + ' %');\n    }).on('mouseout', function (d) {\n      setHoverSent('');\n      divTooltip.style('display', 'none');\n    }); //.on('mouseover', function(d){console.log(d.postName)})\n    // Legend\n\n    /*\n    var legend = svg.selectAll(\".legend\")\n        .data(['Engegment','Sentiment'].slice())\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) { return \"translate(0,\" + i * 20 + \")\"; });\n     legend.append(\"rect\")\n        .attr(\"x\", width - 48)\n        .attr(\"width\", 18)\n        .attr(\"height\", 18)\n        .style(\"fill\", color);\n     legend.append(\"text\")\n        .attr(\"x\", width - 54)\n        .attr(\"y\", 9)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"end\")\n        .text(function(d) { return d; });\n        */\n\n    function wrap(text, width) {\n      text.each(function () {\n        var text = d3.select(this),\n            words = text.text().split(/\\s+/).reverse(),\n            word,\n            line = [],\n            lineNumber = 0,\n            lineHeight = 1.1,\n            // ems\n        y = text.attr(\"y\"),\n            dy = parseFloat(text.attr(\"dy\")),\n            tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n\n        while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n\n          if (tspan.node().getComputedTextLength() > width) {\n            line.pop();\n            tspan.text(line.join(\" \"));\n            line = [word];\n            tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", `${++lineNumber * lineHeight + dy}em`).text(word);\n          }\n        }\n      });\n    }\n  }, [choosenSentiment, hover]); // close useeffect\n\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"barchartContainer\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"btnContainer\",\n        children: [/*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"cha_button\",\n          className: \"groupButtonActive\",\n          onClick: () => getPostsComment(choosenSentiment),\n          children: \"Show only comments\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 356,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          id: \"cat_button\",\n          className: \"groupButtonInactive\",\n          onClick: () => getPosts(choosenSentiment),\n          children: \"Show all\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 357,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 355,\n        columnNumber: 13\n      }, this), /*#__PURE__*/_jsxDEV(\"svg\", {\n        id: \"barChart\",\n        width: \"500\",\n        height: \"270\",\n        ref: d3Container\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 359,\n        columnNumber: 17\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 354,\n      columnNumber: 9\n    }, this)\n  }, void 0, false);\n};\n\n_s(BarChart, \"lVkT8wYYC8FolEgkPieO/aSd+qU=\");\n\n_c = BarChart;\nexport default BarChart;\n\nvar _c;\n\n$RefreshReg$(_c, \"BarChart\");","map":{"version":3,"sources":["/Users/lovisaforsberg/MS_vis/ms_viz/src/components/barchart.js"],"names":["React","useContext","useEffect","useRef","useReducer","useState","createContext","d3","testData","SentimentContext","HoverSentContext","allPostsContext","HoverContext","BarChart","SentSentimentContext","choosenSentiment","setChoosenSentiment","SentHoverSentContext","hoverSent","setHoverSent","SentHoverContext","hover","setHover","console","log","d3Container","post_data","keys","sent","eng","stack_key_mapping","getPosts","data","input","push","name","pos","comments","postname","values","value","yoffset","yscale","total","neg","neu","postName","followers","likes","shares","children","forEach","child","getPostsComment","handleHover","type","changeData","chosen","select","selectAll","remove","margin","top","right","bottom","left","width","height","divTooltip","append","attr","x0","scaleBand","domain","rangeRound","padding","x1","bandwidth","y0","scaleLinear","range","max","d","y1","color","scaleOrdinal","xAxis","axisBottom","ticks","yAxisLeft","axisLeft","tickFormat","format","yAxisRight","axisRight","parseInt","svg","current","xAxisG","call","style","text","graph","join","length","includes","on","event","pageX","pageY","html","toFixed","Math","round","wrap","each","words","split","reverse","word","line","lineNumber","lineHeight","y","dy","parseFloat","tspan","pop","node","getComputedTextLength"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport * as d3 from 'd3'\nimport '../../node_modules/@ibm/plex/css/ibm-plex.css';\nimport '../style/barchart.css'\nimport testData from '../data/sveaskog.csv'\nimport {SentimentContext} from '../App'\nimport {HoverSentContext} from './graphContainer'\nimport {allPostsContext} from './graphContainer'\nimport {HoverContext} from \"../App\";\n\n\nconst BarChart = () =>{\n\n    const SentSentimentContext = useContext(SentimentContext);\n    const {choosenSentiment, setChoosenSentiment} = SentSentimentContext\n\n    const SentHoverSentContext = useContext(HoverSentContext)\n    const {hoverSent, setHoverSent} = SentHoverSentContext\n\n    const SentHoverContext = useContext(HoverContext);\n    const {hover, setHover} = SentHoverContext\n    console.log('hej')\n\n    //const [postData, setPostData] = useState([])\n    //const [keys, setKeys] = useState([])\n    //const [sent, setSent] = useState([])\n    //const [eng, setEng] = useState([])\n\n    //const [input, setInput] = useState('all')\n\n\n    const d3Container = useRef(null)\n\n    var post_data = []\n    var keys = []\n    var sent = []\n    var eng = []\n  \n   var stack_key_mapping={\n    \"Positive\":\"Sentiment\",\n    \"Negative\":\"Sentiment\",\n    \"Neutral\":\"Sentiment\",\n    \"Comments\":\"Engagement\",\n    \"Likes\":\"Engagement\",\n    \"Shares\":\"Engagement\"};\n\n    const getPosts = (data, input) =>{\n        if (!('children' in data)){\n            keys.push(data.name)\n            sent.push(data.pos)\n            eng.push(data.comments)\n            post_data.push({\n                postname: data.name,\n                values: [\n                    //{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n                    //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n                    {name:'Positive', value:data.pos, yoffset: data.pos, yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Negative', value:data.neg, yoffset:(data.neg+data.pos), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Neutral', value:data.neu, yoffset:(data.pos+data.neg+data.neu), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n\n                    {name:'Comments', value:data.comments/(data.followers)*100, yoffset: data.comments/(data.followers)*100, yscale:0, total:(data.comments+data.likes+data.shares)/(data.followers)*100, postName:data.name, followers:data.followers},\n                    {name:'Likes', value:data.likes/(data.followers)*100, yoffset:(data.comments+data.likes)/(data.followers)*100, yscale:0, total:(data.comments+data.likes+data.shares)/(data.followers)*100, postName:data.name, followers:data.followers},\n                    {name:'Shares', value:data.shares/(data.followers)*100, yoffset: (data.comments+data.likes+data.shares)/(data.followers)*100, yscale:0, total:(data.comments+data.likes+data.shares)/(data.followers)*100, postName:data.name, followers:data.followers},\n                ]\n            })\n        }\n        else{\n            data.children.forEach(child =>{\n                getPosts(child)\n            })\n        }\n    }\n\n    const getPostsComment = (data) =>{\n        if (!('children' in data)){\n            keys.push(data.name)\n            sent.push(data.pos)\n            eng.push(data.comments)\n            post_data.push({\n                postname: data.name,\n                values: [\n                    //{name: 'Engagement', com:data.comments, like: data.likes, share: data.shares, post:data.name},\n                    //{name: 'Sentiment', pos:data.pos, neg:data.neg, neu:data.neu, post:data.name}\n                    {name:'Positive', value:data.pos, yoffset: data.pos, yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Negative', value:data.neg, yoffset:(data.neg+data.pos), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n                    {name:'Neutral', value:data.neu, yoffset:(data.pos+data.neg+data.neu), yscale:1, total:(data.pos+data.neg+data.neu), postName:data.name},\n\n                    {name:'Comments', value:data.comments/(data.followers)*100, yoffset: data.comments/(data.followers)*100, yscale:0, total:data.comments/(data.followers)*100, postName:data.name, followers:data.followers},\n                    \n                ]\n            })\n        }\n        else{\n            data.children.forEach(child =>{\n                getPostsComment(child)\n            })\n        }\n    }\n\n    const handleHover = (type) =>{\n        if(type === 'Likes' ||type === 'Comments' ||type === 'Shares'){\n            setHoverSent('eng')\n        }\n        else{\n            setHoverSent(type)\n        }\n    }\n\n    const changeData = (chosen) =>{\n        if(chosen === 'comment'){\n            //setInput('comment')\n        }\n    } \n    \n\n    getPosts(choosenSentiment)\n    //getPostsComment(choosenSentiment)\n    /*\n    const createData = (input) =>{\n        var post_data = []\n        var keys = []\n        var sent = []\n        var eng = []\n        if(input === 'all'){\n            getPosts(choosenSentiment, post_data, keys, sent, eng)\n        }\n        else if( input === 'comment'){\n            getPostsComment(choosenSentiment, post_data, keys, sent, eng)\n        }\n        \n        setPostData(post_data)\n        setKeys(keys)\n        setSent(sent)\n        setEng(eng)\n\n    }\n    */\n    \n    \n\n    useEffect(()=>{\n\n        \n        d3.select(\".root_barchart\").selectAll('*').remove()\n        d3.select(\".legend\").selectAll('*').remove()\n\n    var margin = {top: 20, right: 40, bottom: 60, left: 40},\n    width = 500 - margin.left - margin.right,\n    height = 250 - margin.top - margin.bottom;\n\n    var divTooltip = d3\n        .select('body')\n        .append('div')\n        .attr('class', 'toolTip')\n        .attr('font-size', '100px')\n\n    var x0 = d3.scaleBand()\n        .domain(keys)\n        .rangeRound([0, width])\n        .padding(0.4);\n\n    var x1 = d3.scaleBand()\n        .domain(['Engagement','Sentiment'])\n        .rangeRound([0, x0.bandwidth()])\n        .padding(0.05);\n\n    var y0 = d3.scaleLinear()\n        .range([height, 0])\n        //.domain([0,Math.max(...eng)]);\n        .domain([0, d3.max(post_data, function(d) { return d.values[3].value+d.values[4].value+d.values[5].value; })]);\n        //.domain([0, d3.max(post_data, function(d) { return d.values[3].value})]);\n\n\n    var y1 = d3.scaleLinear()\n        .range([height, 0])\n        .domain([0,100]);\n        \n\n    var color = d3.scaleOrdinal(['#63A37B','#F15645', '#E5E5E5',\n                                '#005282', '#336D90', '#6692AC']);\n\n    var xAxis = d3.axisBottom(x0)\n        //.scale(x0)\n        .ticks(5);\n\n    var yAxisLeft = d3.axisLeft(y0)\n        //.scale(y0)\n        .tickFormat(function(d) {return d3.format(\".00001%\")(d/100)});\n\n    var yAxisRight = d3.axisRight(y1)\n       // .scale(y1)\n        .tickFormat(function(d) { return parseInt(d) });\n\n    var svg = d3.select(d3Container.current)\n        .attr('class', 'root_barchart')\n   \n        .append(\"svg\")\n        .attr(\"width\", width + margin.left + margin.right)\n        .attr(\"height\", height + margin.top + margin.bottom)\n        .append(\"g\")\n        .attr(\"transform\", \"translate(\" + margin.left + \",\" + margin.top + \")\");\n\n\n\n    // Ticks on x-axis and y-axis\n    var xAxisG = svg.append(\"g\")\n        .attr(\"class\", \"x axis\")\n        .attr(\"transform\", \"translate(0,\" + height + \")\")\n        \n        .call(xAxis)\n        //.selectAll(\".tick text\")\n        //.call(wrap, x0.bandwidth())\n        .selectAll(\"text\")\n        .style(\"text-anchor\", \"end\")\n        .attr(\"dx\", \"1.2em\")\n        .attr(\"dy\", \"1em\")\n        .attr('overflow', 'visible')\n        .attr(\"transform\", \"rotate(-20)\")\n        //.style('text-decoration', 'underline')\n        .attr('fill', '#4d4d4d')\n\n        xAxisG.select(\".tick text\")\n        .attr('fill', '#005282');\n\n    svg.append(\"g\")\n        .attr(\"class\", \"y0 axis\")\n        .call(yAxisLeft)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", 6)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"fill\", \"#005282\")\n        .text(\"Engagement rate\");\n\n\n    svg.select('.x axis')\n    .selectAll('text')\n    .style(\"fill\",\"#07737F\");\n\n    svg.append(\"g\")\n        .attr(\"class\", \"y1 axis\")\n        .attr(\"transform\", \"translate(\" + width + \",0)\")\n        .call(yAxisRight)\n        .append(\"text\")\n        .attr(\"transform\", \"rotate(-90)\")\n        .attr(\"y\", -16)\n        .attr(\"dy\", \".71em\")\n        .style(\"text-anchor\", \"end\")\n        .style(\"fill\", \"#63A37B\")\n        .text(\"Sentiment\");\n\n    svg.select('.y1.axis')\n        .selectAll('.tick')\n        .style(\"fill\",\"#d0743c\");\n    // End ticks\n\n    var graph = svg.selectAll(\".date\")\n        .attr('class', 'graph')\n        .data(post_data)\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"g\")\n        .attr(\"transform\", function(d) { return \"translate(\" + x0(d.postname) + \",0)\"; });\n        \n    graph.selectAll(\"rect\")\n        .data(function(d){return d.values})\n        .join('rect')\n        .attr(\"width\", x1.bandwidth())\n        .attr(\"x\", function(d) { return x1(stack_key_mapping[d.name]); })\n        //.attr(\"y\", function(d) { return d.yscale==0 ?  y0(d.yoffset): y1(d.yoffset); })\n        .attr(\"y\", function(d) { return d.yscale==0 ?  y0(d.yoffset): y1(d.yoffset); })\n\n        //.attr(\"height\", function(d) { return height - (d.yscale==0 ? y0(d.value) : y1(d.value)); })\n        .attr(\"height\", function(d) { return height - (d.yscale==0 ? d.name === 'Comments'? y0(d.value):null : y1(d.value)); })\n\n        .attr(\"fill-opacity\", \n           (d)=> hover.length === 0 ? 1 : hover.includes(d.postName) ? 1 : 0.5\n        )\n        .style(\"fill\", function(d) { return color(d.name); })\n        .style(\"cursor\", \"pointer\")\n        .on('mousemove', function(d){\n            handleHover(d.name)\n            divTooltip\n            .style('left', d3.event.pageX+10+'px')\n            .style('top', d3.event.pageY-25+'px')\n            .style('display', 'inline-block')\n            .html(stack_key_mapping[d.name] === 'Engagement'?\n                stack_key_mapping[d.name]+' rate: '+(d.total).toFixed(3)+'%'+'</br>'+d.name+': '+Math.round((d.value)*(d.followers))+' (rate: '+(d.value).toFixed(3)+'%)':\n                d.name+': '+d.value+' %')\n        })\n        .on('mouseout', function(d){\n            setHoverSent('')\n          divTooltip.style('display', 'none')\n        })\n        //.on('mouseover', function(d){console.log(d.postName)})\n\n\n\n    // Legend\n    /*\n    var legend = svg.selectAll(\".legend\")\n        .data(['Engegment','Sentiment'].slice())\n        //.enter()\n        //.append(\"g\")\n        .join('g')\n        .attr(\"class\", \"legend\")\n        .attr(\"transform\", function(d, i) { return \"translate(0,\" + i * 20 + \")\"; });\n\n    legend.append(\"rect\")\n        .attr(\"x\", width - 48)\n        .attr(\"width\", 18)\n        .attr(\"height\", 18)\n        .style(\"fill\", color);\n\n    legend.append(\"text\")\n        .attr(\"x\", width - 54)\n        .attr(\"y\", 9)\n        .attr(\"dy\", \".35em\")\n        .style(\"text-anchor\", \"end\")\n        .text(function(d) { return d; });\n        */\n\n    function wrap(text, width) {\n        text.each(function() {\n        var text = d3.select(this),\n        words = text.text().split(/\\s+/).reverse(),\n        word,\n        line = [],\n        lineNumber = 0,\n        lineHeight = 1.1, // ems\n        y = text.attr(\"y\"),\n        dy = parseFloat(text.attr(\"dy\")),\n        tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\")\n        while (word = words.pop()) {\n            line.push(word)\n            tspan.text(line.join(\" \"))\n            if (tspan.node().getComputedTextLength() > width) {\n                line.pop()\n                tspan.text(line.join(\" \"))\n                line = [word]\n                tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", `${++lineNumber * lineHeight + dy}em`).text(word)\n            }\n        }\n        })\n    }\n\n\n    },[choosenSentiment, hover]) // close useeffect\n\n    return(\n        <>\n        <div className='barchartContainer'>\n            <div className='btnContainer'>\n            <button id='cha_button' className='groupButtonActive' onClick={()=>getPostsComment(choosenSentiment)}>Show only comments</button>\n            <button id='cat_button' className='groupButtonInactive' onClick={()=>getPosts(choosenSentiment)}>Show all</button>\n            </div>\n                <svg id='barChart' width=\"500\" height=\"270\" ref={d3Container}></svg>\n        </div>\n\n        </>\n    )\n\n}\nexport default BarChart"]},"metadata":{},"sourceType":"module"}