{"ast":null,"code":"import _slicedToArray from\"/Users/lovisaforsberg/MS_vis/ms_viz/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useContext,useEffect,useRef,useReducer,useState,createContext}from\"react\";import ReactTooltip from'react-tooltip';import*as d3 from'd3';import data from'../data/test.json';import newdata from'../data/newstructure.json';import{SentimentContext}from'../App';import{HoverContext}from'../App';import{GroupByContext}from'../App';import'../style/sunburst.css';import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";var SunBurst=function SunBurst(){var SentSentimentContext=useContext(SentimentContext);var choosenSentiment=SentSentimentContext.choosenSentiment,setChoosenSentiment=SentSentimentContext.setChoosenSentiment;var SentHoverContext=useContext(HoverContext);var hover=SentHoverContext.hover,setHover=SentHoverContext.setHover;var SentGroupByContext=useContext(GroupByContext);var groupByChannel=SentGroupByContext.groupByChannel,setGroupByChannel=SentGroupByContext.setGroupByChannel;var _useState=useState(choosenSentiment),_useState2=_slicedToArray(_useState,2),choosenData=_useState2[0],setChoosesData=_useState2[1];var _useState3=useState(''),_useState4=_slicedToArray(_useState3,2),navText=_useState4[0],setNavText=_useState4[1];var categories=['around the block','block of the week','caves and cliffs','marketplace highlights','realms plus','taking inventory','engagement driver','pixel art','satisfying loops','community highlights','youtube support'];var handleFilter=function handleFilter(clicked){setChoosenSentiment(clicked);//console.log(clicked)\n};var handleHover=function handleHover(data){if('post_content'in data){var ar=[];ar.push(data.name);setHover(ar);}else if('children'in data){var ar=[];data.children.forEach(function(child){ar.push(child.name);});setHover(ar);}else{setHover([]);}};var handleDataSet=function handleDataSet(click){if(click==='cha'){setChoosenSentiment(data.children[0]);setChoosesData(data.children[0]);setGroupByChannel(true);document.getElementById('cha_button').className='groupButtonActive';document.getElementById('cat_button').className='groupButtonInactive';}else{setChoosenSentiment(newdata.children[0]);setChoosesData(newdata.children[0]);setGroupByChannel(false);document.getElementById('cat_button').className='groupButtonActive';document.getElementById('cha_button').className='groupButtonInactive';}};var handleData=function handleData(channel){if(channel==='fb'){setChoosesData(data.children[0]);setChoosenSentiment(data.children[0]);document.getElementById('fb_button').className='channelButtonActive';document.getElementById('ig_button').className='channelButtonInactive';document.getElementById('tw_button').className='channelButtonInactive';}if(channel==='ig'){setChoosesData(data.children[1]);setChoosenSentiment(data.children[1]);document.getElementById('fb_button').className='channelButtonInactive';document.getElementById('ig_button').className='channelButtonActive';document.getElementById('tw_button').className='channelButtonInactive';}if(channel==='tw'){setChoosesData(data.children[2]);setChoosenSentiment(data.children[2]);document.getElementById('fb_button').className='channelButtonInactive';document.getElementById('ig_button').className='channelButtonInactive';document.getElementById('tw_button').className='channelButtonActive';}};var handleOption=function handleOption(event){console.log(event.target.value);setChoosenSentiment(newdata.children[event.target.value]);setChoosesData(newdata.children[event.target.value]);};var d3Container=useRef(null);useEffect(function(){d3.select(\".root_sunburst\").selectAll('*').remove();//setData(data)\nvar width=500;var radius=width/7;var partition=function partition(choosenData){var root=d3.hierarchy(choosenData).sum(function(d){return d.eng_rate;})//.sort((a, b) => b.value - a.value);\n.sort(function(a,b){return d3.ascending(a.name,b.name);});return d3.partition().size([2*Math.PI,root.height+1])(root);};//var color = d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow, data.children.length + 1));\nvar color=d3.scaleOrdinal(['#07737F','#27306E','#62254A','#7C2438','#A6193C','#FFB86E']);/*\n        var color = d3\n              .scaleOrdinal()\n              .range(['#CC5BA4', '#C65649', '#EAD94C', '#68AD7C', '#59A5CC'])\n              */var format=d3.format(\",d\");var divTooltip=d3.select('body').append('div').attr('class','toolTip').attr('font-size','50px');var arc=d3.arc().startAngle(function(d){return d.x0;}).endAngle(function(d){return d.x1;}).padAngle(function(d){return Math.min((d.x1-d.x0)/2,0.005);}).padRadius(radius*1.5).innerRadius(function(d){return d.y0*radius;}).outerRadius(function(d){return Math.max(d.y0*radius,d.y1*radius-1);});var root=partition(choosenData);root.each(function(d){return d.current=d;});var svg=d3.select(d3Container.current).attr('class','root_sunburst').append('svg')//.style(\"width\", \"100%\")\n//.style(\"height\", \"auto\")\n.style(\"font\",\"10px sans-serif\");d3.select('#sunBurst').data(root.descendants().slice(1)).append('text').attr('class','NaviagationText').html(navText).attr(\"dy\",\"1em\");var g=svg.append(\"g\").attr(\"transform\",\"translate(\".concat(width/2,\",\").concat(width/2,\")\"));var path=g.append(\"g\").selectAll(\"path\").data(root.descendants().slice(1)).enter().append(\"path\").style(\"cursor\",\"pointer\")//.on('click', function(d){console.log(d.data)})\n//.attr(\"fill\", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })\n.attr('fill',function(d){return groupByChannel?d.depth===1?d.data.color:d.parent.data.color:d.depth===1?d.data.color:d.parent.data.color;}//d.depth === 2 ? d.data.color : d.depth === 3 ? d.parent.data.color : color(d.name)\n//d.depth === 2 ?  d.depth === 3 ? d.data.parent.color : 'green' : d.data.color\n)//.attr(\"fill-opacity\", d => arcVisible(d.current) ? (d.children ? 1 : 0.8) : 0)\n.attr(\"fill-opacity\",function(d){return arcVisible(d.current)?d.children?0.6:0.4:0;}).attr(\"d\",function(d){return arc(d.current);}).on('mousemove',function(d){divTooltip.style('left',d3.event.pageX+10+'px').style('top',d3.event.pageY-25+'px').style('display','inline-block').html(d.depth===2?'Post: '+d.data.name:groupByChannel?'Category: '+d.data.name:'Channel: '+d.data.name);}).on('mouseout',function(d){divTooltip.style('display','none');d3.select(this).attr(\"fill-opacity\",function(d){return arcVisible(d.current)?d.children?0.6:0.4:0;});handleHover([]);}).on('click',clicked).on('mouseover',function(d){d3.select(this).attr(\"fill-opacity\",function(d){return arcVisible(d.current)?d.children?0.8:0.6:0;});handleHover(d.data);//console.log(d)\n});path.filter(function(d){return d.children;}).style(\"cursor\",\"pointer\");//.on(\"click\", clicked);\n/*\npath.append(\"title\")\n   // .text(d => `${d.ancestors().map(d => d.data.name).reverse().join(\"/\")}\\n${format(d.value)}`);\n    //.text(d => `${d.data.courseName}`);\n    .text('hejhej')\n    */var label=g.append(\"g\").attr(\"pointer-events\",\"none\").attr(\"text-anchor\",\"middle\").style(\"user-select\",\"none\").selectAll(\"text\").data(root.descendants().slice(1)).join(\"text\").attr('class','pathLabel').attr(\"dy\",\"0.35em\").attr(\"fill-opacity\",function(d){return+labelVisible(d.current);}).attr(\"transform\",function(d){return labelTransform(d.current);})/*\n  .attr(\"transform\", function(d) {return d.data.children !== undefined ?\n     \"translate(\" + arc.centroid(d) + \")rotate(\" + computeTextRotation(d) + \")\":\n     labelTransform(d.current)\n    })\n  */.style('font-size','10px').text(function(d){return d.data.name;})/*\n // SEE ONLY THE LABELS OF THE FIRST LEVEL\n    .style('visibility', function(d) {\n      return isTextVisible(d, 0) ? 'visible' : 'hidden';   \n  })\n  */.style('visibility','visible').call(wrap,20);function computeTextRotation(d){var angle=(d.x0+d.x1)/Math.PI*90;// <-- 1\n// Avoid upside-down labels\nreturn angle<90||angle>270?angle:angle+180;// <--2 \"labels aligned with slices\"\n// Alternate label formatting\n//return (angle < 180) ? angle - 90 : angle + 90;  // <-- 3 \"labels as spokes\"\n}var parent=g.append(\"circle\").datum(root).attr(\"r\",radius).attr(\"fill\",\"none\").attr(\"pointer-events\",\"all\").style('cursor','pointer').on(\"click\",clicked);/*\n  g.append(\"g\")\n  .selectAll(\"circle\")\n  .text('back')\n  .text(function(d){return d.current.data.name})\n  .attr('text-anchor', 'middle')\n  .attr('alignment-baseline', 'middle')\n  .style('font-size', '12px')\n  .style(\"cursor\", \"pointer\")\n  .attr(\"pointer-events\", \"all\")\n  .on(\"click\", function(d){console.log(d.data.name)});\n*/var textParent=g.append(\"text\").datum(root).on('mouseover',function(d){console.log(d);}).attr('id','backText').attr('class','zoomedOut').attr('text-anchor','middle').attr('alignment-baseline','middle').attr(\"pointer-events\",\"all\").attr('fill','#404040').on(\"click\",clicked).style('font-size','12px').style('cursor','pointer').html('');function isTextVisible(d,depth){if(depth===0){return d.depth===0||d.depth===1;}else{return d.depth===depth||d.depth===depth-1;}}function clicked(p){/*\n  SEE ONLY LABEL ON FIRST LEVEL\n d3.selectAll(\".pathLabel\")\n      .style('visibility', function(d2) {\n        return d2.depth > p.depth+1 ? 'hidden' : 'visible'\n      })\n      */handleFilter(p.data);parent.datum(p.parent||root);textParent.datum(p.parent||root);if(p.depth===0){document.getElementById('backText').setAttribute(\"class\",\"zoomedOut\");}else{document.getElementById('backText').setAttribute(\"class\",\"zoomedIn\");}//setZoomedData(p.data)\nroot.each(function(d){return d.target={x0:Math.max(0,Math.min(1,(d.x0-p.x0)/(p.x1-p.x0)))*2*Math.PI,x1:Math.max(0,Math.min(1,(d.x1-p.x0)/(p.x1-p.x0)))*2*Math.PI,y0:Math.max(0,d.y0-p.depth),y1:Math.max(0,d.y1-p.depth)};});var t=g.transition().duration(1500);// Transition the data on all arcs, even the ones that aren’t visible,\n// so that if this transition is interrupted, entering arcs will start\n// the next transition from the desired position.\npath.transition(t).tween(\"data\",function(d){var i=d3.interpolate(d.current,d.target);return function(t){return d.current=i(t);};}).filter(function(d){return+this.getAttribute(\"fill-opacity\")||arcVisible(d.target);}).attr(\"fill-opacity\",function(d){return arcVisible(d.target)?d.children?0.6:0.4:0.4;})//.attr(\"fill-opacity\", function(d){if(d.depth==2){return 0.8}if(d.depth==3){return 0.7}if(d.depth==4){return 0.5}} )\n.attrTween(\"d\",function(d){return function(){return arc(d.current);};});label.filter(function(d){return+this.getAttribute(\"fill-opacity\")||labelVisible(d.target);}).transition(t).attr(\"fill-opacity\",function(d){return+labelVisible(d.target);}).attrTween(\"transform\",function(d){return function(){return labelTransform(d.current);};});}//Aquí se le aumenta el número de arcos que muestra\nfunction arcVisible(d){return d.y1<=4&&d.y0>=1&&d.x1>d.x0;}function labelVisible(d){return d.y1<=5&&d.y0>=1&&(d.y1-d.y0)*(d.x1-d.x0)>0.03;}function labelTransform(d){var x=(d.x0+d.x1)/2*180/Math.PI;var y=(d.y0+d.y1)/2*radius;return\"rotate(\".concat(x-90,\") translate(\").concat(y,\",0) rotate(\").concat(x<180?0:180,\")\");}function wrap(text,width){text.each(function(){var text=d3.select(this),words=text.text().split(/\\s+/).reverse(),word,line=[],lineNumber=0,lineHeight=1,// ems\ny=text.attr(\"y\")-(words.length+1)*4,dy=parseFloat(text.attr(\"dy\")),tspan=text.text(null).append(\"tspan\").attr(\"x\",0).attr(\"y\",y).attr(\"dy\",dy+\"em\");while(word=words.pop()){line.push(word);tspan.text(line.join(\" \"));if(tspan.node().getComputedTextLength()>width){line.pop();tspan.text(line.join(\" \"));line=[word];tspan=text.append(\"tspan\").attr(\"x\",0).attr(\"y\",y).attr(\"dy\",++lineNumber*lineHeight+dy+\"em\").text(word);}}});}},[choosenData]);// close useEffect\nreturn/*#__PURE__*/_jsx(_Fragment,{children:/*#__PURE__*/_jsxs(\"div\",{className:\"sunburstBtn\",children:[/*#__PURE__*/_jsxs(\"div\",{className:\"btnContainer\",children:[/*#__PURE__*/_jsx(\"button\",{id:\"cha_button\",className:\"groupButtonActive\",onClick:function onClick(){return handleDataSet('cha');},children:\"Group by Channel\"}),/*#__PURE__*/_jsx(\"button\",{id:\"cat_button\",className:\"groupButtonInactive\",onClick:function onClick(){return handleDataSet('cat');},children:\"Group by Categories\"})]}),groupByChannel?/*#__PURE__*/_jsxs(\"div\",{className:\"btnContainer\",children:[/*#__PURE__*/_jsx(\"button\",{id:\"fb_button\",className:\"channelButtonActive\",onClick:function onClick(){return handleData('fb');},children:\"Facebook\"}),/*#__PURE__*/_jsx(\"button\",{id:\"ig_button\",className:\"channelButtonInactive\",onClick:function onClick(){return handleData('ig');},children:\"Instagram\"}),/*#__PURE__*/_jsx(\"button\",{id:\"tw_button\",className:\"channelButtonInactive\",onClick:function onClick(){return handleData('tw');},children:\"Twitter\"})]}):/*#__PURE__*/_jsx(\"div\",{className:\"btnContainer\",children:/*#__PURE__*/_jsx(\"select\",{className:\"dropDown\",onChange:function onChange(e){return handleOption(e);},children:categories.map(function(cat,i){return/*#__PURE__*/_jsx(\"option\",{value:i,children:cat});})})}),/*#__PURE__*/_jsxs(\"div\",{className:\"infoContainer\",children:[/*#__PURE__*/_jsx(\"i\",{className:\"fas fa-info-circle\",\"data-tip\":true,\"data-for\":\"sunburstInfo\"}),/*#__PURE__*/_jsxs(ReactTooltip,{id:\"sunburstInfo\",type:\"error\",className:\"infoTooltip\",place:\"bottom\",textColor:\"#4d4d4d\",backgroundColor:\"#FFDFC3\",children:[groupByChannel?/*#__PURE__*/_jsxs(\"p\",{children:[\"The graph shows all posts for \",/*#__PURE__*/_jsx(\"strong\",{children:\"each category\"}),\" in the choosen channel. \"]}):/*#__PURE__*/_jsxs(\"p\",{children:[\"The graph shows all posts for \",/*#__PURE__*/_jsx(\"strong\",{children:\"each channel\"}),\" for the selected category \"]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"The size of each part represents the \",/*#__PURE__*/_jsx(\"strong\",{children:\"engagement rate.\"})]}),/*#__PURE__*/_jsx(\"p\",{children:\"Use the graph to zoom into specific categories or posts.\"}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Click on a post get more details and \",/*#__PURE__*/_jsx(\"strong\",{children:\"insights.\"})]})]})]}),/*#__PURE__*/_jsx(\"svg\",{id:\"sunBurst\",width:500,height:500,radius:500/2,ref:d3Container})]})});};// close Areachart component\nexport default SunBurst;","map":{"version":3,"sources":["/Users/lovisaforsberg/MS_vis/ms_viz/src/components/sunburst.js"],"names":["React","useContext","useEffect","useRef","useReducer","useState","createContext","ReactTooltip","d3","data","newdata","SentimentContext","HoverContext","GroupByContext","SunBurst","SentSentimentContext","choosenSentiment","setChoosenSentiment","SentHoverContext","hover","setHover","SentGroupByContext","groupByChannel","setGroupByChannel","choosenData","setChoosesData","navText","setNavText","categories","handleFilter","clicked","handleHover","ar","push","name","children","forEach","child","handleDataSet","click","document","getElementById","className","handleData","channel","handleOption","event","console","log","target","value","d3Container","select","selectAll","remove","width","radius","partition","root","hierarchy","sum","d","eng_rate","sort","a","b","ascending","size","Math","PI","height","color","scaleOrdinal","format","divTooltip","append","attr","arc","startAngle","x0","endAngle","x1","padAngle","min","padRadius","innerRadius","y0","outerRadius","max","y1","each","current","svg","style","descendants","slice","html","g","path","enter","depth","parent","arcVisible","on","pageX","pageY","filter","label","join","labelVisible","labelTransform","text","call","wrap","computeTextRotation","angle","datum","textParent","isTextVisible","p","setAttribute","t","transition","duration","tween","i","interpolate","getAttribute","attrTween","x","y","words","split","reverse","word","line","lineNumber","lineHeight","length","dy","parseFloat","tspan","pop","node","getComputedTextLength","e","map","cat"],"mappings":"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","sourcesContent":["import React, { useContext, useEffect, useRef, useReducer, useState, createContext } from \"react\";\nimport ReactTooltip from 'react-tooltip';\nimport * as d3 from 'd3'\nimport data from '../data/test.json'\nimport newdata from '../data/newstructure.json'\nimport {SentimentContext} from '../App'\nimport {HoverContext} from '../App'\nimport {GroupByContext} from '../App'\nimport '../style/sunburst.css'\n\n\nconst SunBurst = ()=> {\n\n  const SentSentimentContext = useContext(SentimentContext);\n  const {choosenSentiment, setChoosenSentiment} = SentSentimentContext\n\n  const SentHoverContext = useContext(HoverContext);\n  const {hover, setHover} = SentHoverContext\n\n  const SentGroupByContext = useContext(GroupByContext);\n  const {groupByChannel, setGroupByChannel} = SentGroupByContext\n\n  const [choosenData, setChoosesData] = useState(choosenSentiment)\n  const [navText, setNavText] = useState('')\n\n\n  const categories = ['around the block', 'block of the week', 'caves and cliffs', 'marketplace highlights', 'realms plus', 'taking inventory', 'engagement driver', 'pixel art', 'satisfying loops', 'community highlights', 'youtube support']\n\n  const handleFilter = (clicked) => {\n    setChoosenSentiment(clicked)\n    //console.log(clicked)\n  }\n  const handleHover = (data) => {\n    if('post_content' in data){\n      var ar = []\n      ar.push(data.name)\n      setHover(ar)\n    }\n    else if('children' in data){\n      var ar = []\n      data.children.forEach(child=>{\n        ar.push(child.name)\n      })\n      setHover(ar)\n    }\n    else{\n      setHover([])\n    }\n  }\n\n  const handleDataSet = (click) =>{\n    if(click === 'cha'){\n      setChoosenSentiment(data.children[0])\n      setChoosesData(data.children[0])\n      setGroupByChannel(true)\n      document.getElementById('cha_button').className = 'groupButtonActive'\n      document.getElementById('cat_button').className = 'groupButtonInactive'\n\n\n    }\n    else{\n      setChoosenSentiment(newdata.children[0])\n      setChoosesData(newdata.children[0])\n      setGroupByChannel(false)\n      document.getElementById('cat_button').className = 'groupButtonActive'\n      document.getElementById('cha_button').className = 'groupButtonInactive'\n\n\n    }\n}\n\n  const handleData = (channel) =>{\n    if (channel === 'fb'){\n      setChoosesData(data.children[0])\n      setChoosenSentiment(data.children[0])\n      document.getElementById('fb_button').className = 'channelButtonActive'\n      document.getElementById('ig_button').className = 'channelButtonInactive'\n      document.getElementById('tw_button').className = 'channelButtonInactive'\n\n    }\n    if (channel === 'ig'){\n      setChoosesData(data.children[1])\n      setChoosenSentiment(data.children[1])\n      document.getElementById('fb_button').className = 'channelButtonInactive'\n      document.getElementById('ig_button').className = 'channelButtonActive'\n      document.getElementById('tw_button').className = 'channelButtonInactive'\n    }\n    if (channel === 'tw'){\n      setChoosesData(data.children[2])\n      setChoosenSentiment(data.children[2])\n      document.getElementById('fb_button').className = 'channelButtonInactive'\n      document.getElementById('ig_button').className = 'channelButtonInactive'\n      document.getElementById('tw_button').className = 'channelButtonActive'\n    }\n  }\n\n  const handleOption = (event) =>{\n    console.log(event.target.value)\n    setChoosenSentiment(newdata.children[event.target.value])\n    setChoosesData(newdata.children[event.target.value])\n  }\n\n\n    const d3Container = useRef(null)\n\n    useEffect(()=>{\n    \n    d3.select(\".root_sunburst\").selectAll('*').remove()\n\n    //setData(data)\n\n    const width = 500\n    const radius = width / 7\n\n\n    const partition = choosenData => {\n        const root = d3.hierarchy(choosenData)\n        .sum(d => (d.eng_rate))\n        //.sort((a, b) => b.value - a.value);\n        .sort(function(a, b) { return d3.ascending(a.name, b.name); })\n\n        return d3.partition()\n        .size([2 * Math.PI, root.height + 1])\n        (root);\n      }\n  \n        //var color = d3.scaleOrdinal(d3.quantize(d3.interpolateRainbow, data.children.length + 1));\n        var color = d3\n              .scaleOrdinal(['#07737F','#27306E', '#62254A', '#7C2438', '#A6193C', '#FFB86E'])\n        /*\n        var color = d3\n              .scaleOrdinal()\n              .range(['#CC5BA4', '#C65649', '#EAD94C', '#68AD7C', '#59A5CC'])\n              */\n\n      const format = d3.format(\",d\");\n\n      var divTooltip = d3\n        .select('body')\n        .append('div')\n        .attr('class', 'toolTip')\n        .attr('font-size', '50px')\n\n\n      const arc = d3.arc()\n        .startAngle(d => d.x0)\n        .endAngle(d => d.x1)\n        .padAngle(d => Math.min((d.x1 - d.x0) / 2, 0.005))\n        .padRadius(radius * 1.5)\n        .innerRadius(d => d.y0 * radius)\n        .outerRadius(d => (Math.max(d.y0 * radius, d.y1 * radius - 1)));\n\n      const root = partition(choosenData);\n\n      root.each(d => d.current = d);\n\n\n\n\nconst svg = d3.select(d3Container.current)\n    .attr('class', 'root_sunburst')\n    .append('svg')\n    //.style(\"width\", \"100%\")\n    //.style(\"height\", \"auto\")\n    .style(\"font\", \"10px sans-serif\");\n\n\nd3.select('#sunBurst')\n.data(root.descendants().slice(1))\n.append('text')\n.attr('class', 'NaviagationText')\n.html(navText)\n.attr(\"dy\", \"1em\")\n\nconst g = svg.append(\"g\")\n    .attr(\"transform\", `translate(${width/2},${width/2})`);\n\nconst path = g.append(\"g\")\n.selectAll(\"path\")\n.data(root.descendants().slice(1))\n.enter().append(\"path\")\n.style(\"cursor\", \"pointer\")\n//.on('click', function(d){console.log(d.data)})\n  //.attr(\"fill\", d => { while (d.depth > 1) d = d.parent; return color(d.data.name); })\n  .attr('fill', d=> groupByChannel ? d.depth === 1 ? d.data.color : d.parent.data.color :\n  d.depth === 1 ? d.data.color : d.parent.data.color\n  //d.depth === 2 ? d.data.color : d.depth === 3 ? d.parent.data.color : color(d.name)\n  //d.depth === 2 ?  d.depth === 3 ? d.data.parent.color : 'green' : d.data.color\n  \n  )\n  //.attr(\"fill-opacity\", d => arcVisible(d.current) ? (d.children ? 1 : 0.8) : 0)\n  .attr(\"fill-opacity\", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)\n\n  .attr(\"d\", d => arc(d.current))\n\n  .on('mousemove', function(d){\n      divTooltip\n      .style('left', d3.event.pageX+10+'px')\n      .style('top', d3.event.pageY-25+'px')\n      .style('display', 'inline-block')\n      .html(d.depth === 2 ? 'Post: '+d.data.name : groupByChannel ? 'Category: '+d.data.name: 'Channel: '+d.data.name)\n  })\n  .on('mouseout', function(d){\n    divTooltip.style('display', 'none')\n    d3.select(this).attr(\"fill-opacity\", d => arcVisible(d.current) ? (d.children ? 0.6 : 0.4) : 0)\n    handleHover([])\n  })\n  .on('click', clicked)\n  \n  .on('mouseover', function(d){\n    d3.select(this).attr(\"fill-opacity\", d => arcVisible(d.current) ? (d.children ? 0.8 : 0.6) : 0)\n    handleHover(d.data)\n    //console.log(d)\n  })\n\n\n\npath.filter(d => d.children)\n    .style(\"cursor\", \"pointer\")\n    //.on(\"click\", clicked);\n\n\n    /*\npath.append(\"title\")\n   // .text(d => `${d.ancestors().map(d => d.data.name).reverse().join(\"/\")}\\n${format(d.value)}`);\n    //.text(d => `${d.data.courseName}`);\n    .text('hejhej')\n    */\n\n  const label = g\n  .append(\"g\")\n  .attr(\"pointer-events\", \"none\")\n  .attr(\"text-anchor\", \"middle\")\n  .style(\"user-select\", \"none\")\n  .selectAll(\"text\")\n  .data(root.descendants().slice(1))\n  .join(\"text\")\n  .attr('class', 'pathLabel')\n  .attr(\"dy\", \"0.35em\")\n  .attr(\"fill-opacity\", d => +labelVisible(d.current))\n  .attr(\"transform\", d => labelTransform(d.current))\n  /*\n  .attr(\"transform\", function(d) {return d.data.children !== undefined ?\n     \"translate(\" + arc.centroid(d) + \")rotate(\" + computeTextRotation(d) + \")\":\n     labelTransform(d.current)\n    })\n  */\n  \n  .style('font-size', '10px')\n  .text(d=> d.data.name)\n /*\n // SEE ONLY THE LABELS OF THE FIRST LEVEL\n    .style('visibility', function(d) {\n      return isTextVisible(d, 0) ? 'visible' : 'hidden';   \n  })\n  */\n .style('visibility', 'visible')\n  .call(wrap, 20);\n\n  function computeTextRotation(d) {\n    var angle = (d.x0 + d.x1) / Math.PI * 90;  // <-- 1\n\n    // Avoid upside-down labels\n    return (angle < 90 || angle > 270) ? angle : angle + 180;  // <--2 \"labels aligned with slices\"\n\n    // Alternate label formatting\n    //return (angle < 180) ? angle - 90 : angle + 90;  // <-- 3 \"labels as spokes\"\n}\n\n\nconst parent = g.append(\"circle\")\n    .datum(root)\n    .attr(\"r\", radius)\n    .attr(\"fill\", \"none\")\n    .attr(\"pointer-events\", \"all\")\n    .style('cursor', 'pointer')\n    .on(\"click\", clicked)\n/*\n  g.append(\"g\")\n  .selectAll(\"circle\")\n  .text('back')\n  .text(function(d){return d.current.data.name})\n  .attr('text-anchor', 'middle')\n  .attr('alignment-baseline', 'middle')\n  .style('font-size', '12px')\n  .style(\"cursor\", \"pointer\")\n  .attr(\"pointer-events\", \"all\")\n  .on(\"click\", function(d){console.log(d.data.name)});\n*/\n\nconst textParent = g.append(\"text\")\n  .datum(root)\n  .on('mouseover', function(d){console.log(d)})\n  .attr('id', 'backText')\n  .attr('class', 'zoomedOut')\n  .attr('text-anchor', 'middle')\n  .attr('alignment-baseline', 'middle')\n  .attr(\"pointer-events\", \"all\")\n  .attr('fill', '#404040')\n  .on(\"click\", clicked)\n\n  .style('font-size', '12px')\n  .style('cursor', 'pointer')\n  .html('')\n\n\nfunction isTextVisible(d, depth){\n    if (depth === 0){\n      return d.depth === 0 || d.depth === 1;\n    } else {\n      return d.depth === depth || d.depth === depth - 1;\n    }\n  }\n\n\n\nfunction clicked(p) {\n  \n  /*\n  SEE ONLY LABEL ON FIRST LEVEL\n d3.selectAll(\".pathLabel\")\n      .style('visibility', function(d2) {\n        return d2.depth > p.depth+1 ? 'hidden' : 'visible'\n      })\n      */\n\n  handleFilter(p.data)\n  parent.datum(p.parent || root);\n  textParent.datum(p.parent || root);\n\n  if(p.depth === 0){\n    document.getElementById('backText').setAttribute(\"class\", \"zoomedOut\")\n  }\n  else{\n    document.getElementById('backText').setAttribute(\"class\", \"zoomedIn\")\n  }\n  \n  \n//setZoomedData(p.data)\n\n  root.each(d => d.target = {\n    x0: Math.max(0, Math.min(1, (d.x0 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n    x1: Math.max(0, Math.min(1, (d.x1 - p.x0) / (p.x1 - p.x0))) * 2 * Math.PI,\n    y0: Math.max(0, d.y0 - p.depth),\n    y1: Math.max(0, d.y1 - p.depth)\n  });\n\n  const t = g.transition().duration(1500);\n\n  // Transition the data on all arcs, even the ones that aren’t visible,\n  // so that if this transition is interrupted, entering arcs will start\n  // the next transition from the desired position.\n  path.transition(t)\n      .tween(\"data\", d => {\n        const i = d3.interpolate(d.current, d.target);\n        return t => d.current = i(t);\n      })\n    .filter(function(d) {\n      return +this.getAttribute(\"fill-opacity\") || arcVisible(d.target);\n    })\n      .attr(\"fill-opacity\", d => arcVisible(d.target) ? (d.children ? 0.6 : 0.4) : 0.4)\n      //.attr(\"fill-opacity\", function(d){if(d.depth==2){return 0.8}if(d.depth==3){return 0.7}if(d.depth==4){return 0.5}} )\n\n      .attrTween(\"d\", d => () => arc(d.current));\n\n  label.filter(function(d) {\n      return +this.getAttribute(\"fill-opacity\") || labelVisible(d.target);\n    }).transition(t)\n      .attr(\"fill-opacity\", d => +labelVisible(d.target))      \n      .attrTween(\"transform\", d => () => labelTransform(d.current));\n\n}\n\n//Aquí se le aumenta el número de arcos que muestra\nfunction arcVisible(d) {\n  return d.y1 <= 4 && d.y0 >= 1 && d.x1 > d.x0;\n}\n\n\nfunction labelVisible(d) {\n  return d.y1 <= 5 && d.y0 >= 1 && (d.y1 - d.y0) * (d.x1 - d.x0) > 0.03;\n}\n\nfunction labelTransform(d) {\n  const x = (d.x0 + d.x1) / 2 * 180 / Math.PI;\n  const y = (d.y0 + d.y1) / 2 * radius;\n  return `rotate(${x - 90}) translate(${y},0) rotate(${x < 180 ? 0 : 180})`;\n}\n\nfunction wrap(text, width) {\n  text.each(function () {\n      var text = d3.select(this),\n          words = text.text().split(/\\s+/).reverse(),\n          word,\n          line = [],\n          lineNumber = 0,\n          lineHeight = 1, // ems\n          y = text.attr(\"y\")-((words.length+1)*4),\n          dy = parseFloat(text.attr(\"dy\")),\n          tspan = text.text(null).append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", dy + \"em\");\n      while (word = words.pop()) {\n          line.push(word);\n          tspan.text(line.join(\" \"));\n          if (tspan.node().getComputedTextLength() > width) {\n              line.pop();\n              tspan.text(line.join(\" \"));\n              line = [word];\n              tspan = text.append(\"tspan\").attr(\"x\", 0).attr(\"y\", y).attr(\"dy\", ++lineNumber * lineHeight + dy + \"em\").text(word);\n          }\n      }\n  });\n}\n\n    }, [choosenData]) // close useEffect\n\n    return(\n      <>\n      <div className='sunburstBtn'>\n      <div className='btnContainer'>\n          <button id='cha_button' className='groupButtonActive' onClick={()=>handleDataSet('cha')}>Group by Channel</button>\n          <button id='cat_button' className='groupButtonInactive' onClick={()=>handleDataSet('cat')}>Group by Categories</button>\n        </div>\n        {groupByChannel ? \n          <div className='btnContainer'>\n            <button id='fb_button' className='channelButtonActive' onClick={()=>handleData('fb')}>Facebook</button>\n            <button id='ig_button' className='channelButtonInactive' onClick={()=>handleData('ig')}>Instagram</button>\n            <button id='tw_button'className='channelButtonInactive' onClick={()=>handleData('tw')}>Twitter</button>\n          </div>:\n          <div className='btnContainer'>\n            <select className='dropDown' onChange={e=>handleOption(e)}>\n            {categories.map((cat, i)=>{\n                    return (<option value={i}>{cat}</option>)             \n                })}\n  \n            </select>\n            {/*\n            {categories.map( cat=>{\n                    return (<button id='fb_button' className='channelButtonActive small' onClick={()=>handleData('fb')}>{cat}</button>)             \n                })}\n              */}\n          </div>\n          }\n          <div className='infoContainer'>\n            <i className=\"fas fa-info-circle\" data-tip data-for='sunburstInfo'></i>\n            <ReactTooltip id='sunburstInfo' type='error' className=\"infoTooltip\" place=\"bottom\" textColor='#4d4d4d' backgroundColor='#FFDFC3'>\n              {groupByChannel ?\n              <p>The graph shows all posts for <strong>each category</strong> in the choosen channel. </p>:\n              <p>The graph shows all posts for <strong>each channel</strong> for the selected category </p>}\n              <p>The size of each part represents the <strong>engagement rate.</strong></p>\n              <p>Use the graph to zoom into specific categories or posts.</p>\n              <p>Click on a post get more details and <strong>insights.</strong></p>\n\n\n            </ReactTooltip>\n          </div>\n\n          <svg id='sunBurst' width={500} height={500} radius={500/2} ref={d3Container}></svg>\n      </div>\n      </>\n    )\n\n} // close Areachart component\nexport default SunBurst; \n"]},"metadata":{},"sourceType":"module"}